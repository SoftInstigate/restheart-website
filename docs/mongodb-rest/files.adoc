---
title: Managing Binary Files with RESTHeart
layout: docs-adoc
menu: mongodb
liquid: true
---

++++
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="/js/interactive-docs-config.js"></script>
{% include interactive-docs-config.html %}
++++

RESTHeart provides full support for storing and retrieving binary files of any size in MongoDB. This functionality uses MongoDB's **GridFS**, which allows storing files that exceed the BSON document size limit of 16MB.

TIP: GridFS automatically splits large files into smaller chunks and stores them in separate documents.

=== File Buckets

==== What is a File Bucket?

A file bucket is a special collection designed for storing binary files along with their metadata. In MongoDB terms, it's a GridFS bucket.

IMPORTANT: File bucket names must end with `.files` (e.g., `images.files` is a valid file bucket name)

==== Creating a File Bucket

To store binary files, first create a file bucket:

{% include code-header.html type="Request" %}

[source,http]
----
PUT [INSTANCE-URL]/mybucket.files HTTP/1.1
Authorization: Basic [BASIC-AUTH]
----

[source,bash]
----
curl -X PUT [INSTANCE-URL]/mybucket.files \
  -H "Authorization: Basic [BASIC-AUTH]"
----

[source,bash]
----
http PUT [INSTANCE-URL]/mybucket.files \
  Authorization:"Basic [BASIC-AUTH]"
----

[source,javascript]
----
fetch('[INSTANCE-URL]/mybucket.files', {
  method: 'PUT',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  }
})
----

{% include code-header.html type="Response" %}

[source,http]
----
HTTP/1.1 201 Created
----

=== Uploading Files

==== POST - Upload a New File

To upload a file, use a `POST` request with `multipart/form-data` encoding:

{% include code-header.html type="Request" %}

[source,http]
----
POST [INSTANCE-URL]/mybucket.files HTTP/1.1
Authorization: Basic [BASIC-AUTH]
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="example.jpg"
Content-Type: image/jpeg

(binary data)
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="metadata"

{"author":"SoftInstigate", "category":"documentation"}
------WebKitFormBoundary7MA4YWxkTrZu0gW--
----

[source,bash]
----
curl -X POST [INSTANCE-URL]/mybucket.files \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -F "file=@/path/to/example.jpg" \
  -F 'metadata={"author":"SoftInstigate","category":"documentation"}'
----

[source,bash]
----
http --form POST [INSTANCE-URL]/mybucket.files \
  Authorization:"Basic [BASIC-AUTH]" \
  file@/path/to/example.jpg \
  metadata='{"author":"SoftInstigate","category":"documentation"}'
----

[source,javascript]
----
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('metadata', JSON.stringify({
  "author": "SoftInstigate",
  "category": "documentation"
}));

fetch('[INSTANCE-URL]/mybucket.files', {
  method: 'POST',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  },
  body: formData
})
----

The request has two parts:
* `file`: The binary content of the file
* `metadata`: A JSON object with custom metadata (optional)


{% include code-header.html type="Response" %}

[source,http]
----
HTTP/1.1 201 Created
Location: [INSTANCE-URL]/mybucket.files/60f8a7b9e4b053f542c13ece
----

The `Location` header contains the URI of the newly created file, with the automatically generated ID.

==== PUT - Upload with a Custom ID

To upload a file with a specific ID, use a `PUT` request:

{% include code-header.html type="Request" %}

[source,http]
----
PUT [INSTANCE-URL]/mybucket.files/my-custom-id HTTP/1.1
Authorization: Basic [BASIC-AUTH]
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="example.jpg"
Content-Type: image/jpeg

(binary data)
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="metadata"

{"author":"SoftInstigate", "category":"documentation"}
------WebKitFormBoundary7MA4YWxkTrZu0gW--
----

[source,bash]
----
curl -X PUT [INSTANCE-URL]/mybucket.files/my-custom-id \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -F "file=@/path/to/example.jpg" \
  -F 'metadata={"author":"SoftInstigate","category":"documentation"}'
----

[source,bash]
----
http --form PUT [INSTANCE-URL]/mybucket.files/my-custom-id \
  Authorization:"Basic [BASIC-AUTH]" \
  file@/path/to/example.jpg \
  metadata='{"author":"SoftInstigate","category":"documentation"}'
----

[source,javascript]
----
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('metadata', JSON.stringify({
  "author": "SoftInstigate",
  "category": "documentation"
}));

fetch('[INSTANCE-URL]/mybucket.files/my-custom-id', {
  method: 'PUT',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  },
  body: formData
})
----

=== Retrieving Files

==== GET - File Metadata

To retrieve a file's metadata:

{% include code-header.html type="Request" %}

[source,http]
----
GET [INSTANCE-URL]/mybucket.files/my-custom-id HTTP/1.1
Authorization: Basic [BASIC-AUTH]
----

[source,bash]
----
curl -X GET [INSTANCE-URL]/mybucket.files/my-custom-id \
  -H "Authorization: Basic [BASIC-AUTH]"
----

[source,bash]
----
http GET [INSTANCE-URL]/mybucket.files/my-custom-id \
  Authorization:"Basic [BASIC-AUTH]"
----

[source,javascript]
----
fetch('[INSTANCE-URL]/mybucket.files/my-custom-id', {
  method: 'GET',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  }
})
----

{% include code-header.html type="Response" %}

[source,http]
----
HTTP/1.1 200 OK
Content-Type: application/json

{
    "_id": "my-custom-id",
    "chunkSize": 261120,
    "filename": "example.jpg",
    "length": 66273,
    "metadata": {
        "_etag": {
            "$oid": "60f8a7b9e4b053f542c13ecd"
        },
        "author": "SoftInstigate",
        "category": "documentation",
        "contentType": "image/jpeg"
    },
    "uploadDate": {
        "$date": 1626955705283
    }
}
----

The response includes:

* `_id`: The file identifier
* `chunkSize`: The size of each chunk in bytes
* `filename`: The original filename
* `length`: Total file size in bytes
* `metadata`: Custom metadata plus system-generated fields
* `uploadDate`: When the file was uploaded

==== GET - File Binary Content

To retrieve the actual binary file:

{% include code-header.html type="Request" %}

[source,http]
----
GET [INSTANCE-URL]/mybucket.files/my-custom-id/binary HTTP/1.1
Authorization: Basic [BASIC-AUTH]
----

[source,bash]
----
curl -X GET [INSTANCE-URL]/mybucket.files/my-custom-id/binary \
  -H "Authorization: Basic [BASIC-AUTH]"
----

[source,bash]
----
http GET [INSTANCE-URL]/mybucket.files/my-custom-id/binary \
  Authorization:"Basic [BASIC-AUTH]"
----

[source,javascript]
----
fetch('[INSTANCE-URL]/mybucket.files/my-custom-id/binary', {
  method: 'GET',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  }
})
----

{% include code-header.html type="Response" %}

[source,http]
----
HTTP/1.1 200 OK
Content-Type: image/jpeg
Content-Length: 66273

(binary data)
----

RESTHeart automatically sets the appropriate `Content-Type` header based on the detected file type.

==== Filtering Files by Metadata

You can query files by their metadata just like regular documents:

{% include code-header.html type="Request" %}

[source,http]
----
GET [INSTANCE-URL]/mybucket.files?filter={"metadata.author":"SoftInstigate"} HTTP/1.1
Authorization: Basic [BASIC-AUTH]
----

[source,bash]
----
curl -X GET "[INSTANCE-URL]/mybucket.files?filter={\"metadata.author\":\"SoftInstigate\"}" \
  -H "Authorization: Basic [BASIC-AUTH]"
----

[source,bash]
----
http GET [INSTANCE-URL]/mybucket.files \
  Authorization:"Basic [BASIC-AUTH]" \
  filter=='{\'metadata.author\':"SoftInstigate"}'
----

[source,javascript]
----
const filter = encodeURIComponent(JSON.stringify({"metadata.author":"SoftInstigate"}));
fetch(`[INSTANCE-URL]/mybucket.files?filter=${filter}`, {
  method: 'GET',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  }
})
----

This returns metadata for all files with the specified author.

=== Updating File Metadata

==== PATCH - Update Specific Metadata Fields

To update specific metadata fields:

{% include code-header.html type="Request" %}

[source,http]
----
PATCH [INSTANCE-URL]/mybucket.files/my-custom-id HTTP/1.1
Authorization: Basic [BASIC-AUTH]
Content-Type: application/json

{
    "metadata.category": "images",
    "metadata.tags": ["example", "documentation"]
}
----

[source,bash]
----
curl -X PATCH [INSTANCE-URL]/mybucket.files/my-custom-id \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -H "Content-Type: application/json" \
  -d '{
    "metadata.category": "images",
    "metadata.tags": ["example", "documentation"]
  }'
----

[source,bash]
----
http PATCH [INSTANCE-URL]/mybucket.files/my-custom-id \
  Authorization:"Basic [BASIC-AUTH]" \
  Content-Type:application/json \
  metadata.category="images" \
  metadata.tags:='["example", "documentation"]'
----

[source,javascript]
----
fetch('[INSTANCE-URL]/mybucket.files/my-custom-id', {
  method: 'PATCH',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    "metadata.category": "images",
    "metadata.tags": ["example", "documentation"]
  })
})
----

IMPORTANT: When updating metadata, use `Content-Type: application/json`, not multipart/form-data.

==== PUT - Replace All Metadata

To completely replace the metadata:

{% include code-header.html type="Request" %}

[source,http]
----
PUT [INSTANCE-URL]/mybucket.files/my-custom-id HTTP/1.1
Authorization: Basic [BASIC-AUTH]
Content-Type: application/json

{
    "metadata": {
        "author": "New Author",
        "category": "updated"
    }
}
----

[source,bash]
----
curl -X PUT [INSTANCE-URL]/mybucket.files/my-custom-id \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -H "Content-Type: application/json" \
  -d '{
    "metadata": {
        "author": "New Author",
        "category": "updated"
    }
  }'
----

[source,bash]
----
http PUT [INSTANCE-URL]/mybucket.files/my-custom-id \
  Authorization:"Basic [BASIC-AUTH]" \
  Content-Type:application/json \
  metadata:='{
    "author": "New Author",
    "category": "updated"
  }'
----

[source,javascript]
----
fetch('[INSTANCE-URL]/mybucket.files/my-custom-id', {
  method: 'PUT',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    "metadata": {
      "author": "New Author",
      "category": "updated"
    }
  })
})
----

NOTE: Update operators and aggregation pipelines cannot be used with file metadata updates.

=== Deleting Files

To delete a file and all its chunks:

{% include code-header.html type="Request" %}

[source,http]
----
DELETE [INSTANCE-URL]/mybucket.files/my-custom-id HTTP/1.1
Authorization: Basic [BASIC-AUTH]
----

[source,bash]
----
curl -X DELETE [INSTANCE-URL]/mybucket.files/my-custom-id \
  -H "Authorization: Basic [BASIC-AUTH]"
----

[source,bash]
----
http DELETE [INSTANCE-URL]/mybucket.files/my-custom-id \
  Authorization:"Basic [BASIC-AUTH]"
----

[source,javascript]
----
fetch('[INSTANCE-URL]/mybucket.files/my-custom-id', {
  method: 'DELETE',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  }
})
----

=== Important Notes

1. RESTHeart automatically detects and sets the file's content type
2. File operations don't support write modes - POST is always insert, PUT is always upsert
3. File metadata can be queried with the same operators as regular documents
4. File buckets have two underlying collections in MongoDB: `<bucket-name>.files` for metadata and `<bucket-name>.chunks` for content
5. Binary content is accessed with the `/binary` suffix

=== Examples

==== Example 1: Upload and serve an image

{% include code-header.html type="Request" %}

[source,bash]
----
# Upload an image
curl -X POST [INSTANCE-URL]/images.files \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -F "file=@/path/to/logo.png" \
  -F 'metadata={"purpose":"website"}'
----

[source,bash]
----
# Upload an image
http --form POST [INSTANCE-URL]/images.files \
  Authorization:"Basic [BASIC-AUTH]" \
  file@/path/to/logo.png \
  metadata='{"purpose":"website"}'
----

[source,javascript]
----
// Upload an image
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('metadata', JSON.stringify({"purpose":"website"}));

fetch('[INSTANCE-URL]/images.files', {
  method: 'POST',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  },
  body: formData
})
----

Access the image in a web page:

[source,html]
----
<img src="[INSTANCE-URL]/images.files/60f8a7b9e4b053f542c13ece/binary" alt="Logo">
----

==== Example 2: Upload a document and track versions

{% include code-header.html type="Request" %}

[source,bash]
----
# Upload initial version
curl -X PUT [INSTANCE-URL]/documents.files/contract-2023 \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -F "file=@/path/to/document.pdf" \
  -F 'metadata={"version":"1.0","author":"John"}'
----

[source,bash]
----
# Upload initial version
http --form PUT [INSTANCE-URL]/documents.files/contract-2023 \
  Authorization:"Basic [BASIC-AUTH]" \
  file@/path/to/document.pdf \
  metadata='{"version":"1.0","author":"John"}'
----

[source,javascript]
----
// Upload initial version
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('metadata', JSON.stringify({
  "version": "1.0",
  "author": "John"
}));

fetch('[INSTANCE-URL]/documents.files/contract-2023', {
  method: 'PUT',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  },
  body: formData
})
----

Update the file and increment version:

{% include code-header.html type="Request" %}

[source,bash]
----
# Update the file and increment version
curl -X PUT [INSTANCE-URL]/documents.files/contract-2023 \
  -H "Authorization: Basic [BASIC-AUTH]" \
  -F "file=@/path/to/document_updated.pdf" \
  -F 'metadata={"version":"1.1","author":"John","updated":"2023-07-15"}'
----

[source,bash]
----
# Update the file and increment version  
http --form PUT [INSTANCE-URL]/documents.files/contract-2023 \
  Authorization:"Basic [BASIC-AUTH]" \
  file@/path/to/document_updated.pdf \
  metadata='{"version":"1.1","author":"John","updated":"2023-07-15"}'
----

[source,javascript]
----
// Update the file and increment version
const updatedFormData = new FormData();
updatedFormData.append('file', updatedFileInput.files[0]);
updatedFormData.append('metadata', JSON.stringify({
  "version": "1.1",
  "author": "John",
  "updated": "2023-07-15"
}));

fetch('[INSTANCE-URL]/documents.files/contract-2023', {
  method: 'PUT',
  headers: {
    'Authorization': 'Basic [BASIC-AUTH]'
  },
  body: updatedFormData
})
----
