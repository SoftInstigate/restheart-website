<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->

<html lang="en">
<!--<![endif]-->
<head>
   <meta charset="utf-8">
   <title>RESTHeart - Develop Core Plugins</title>
   <meta name="description" content="Low code API Framework for MongoDB">
   <meta name="author" content="SoftInstigate srl">
   <meta name="keywords" content="restheart,mongodb,rest,,graphql,api,http,microservice,java,framework">
   <!-- Open Graph -->
   <meta property="og:type" content="website">
   <meta property="og:url" content="https://restheart.org">
   <meta property="og:logo" content="/images/restheart logo.svg">
   <meta property="og:title" content="RESTHeart - Develop Core Plugins">
   <meta property="og:description" content="Low code API Framework for MongoDB">
   <meta property="og:locale" content="en">
   
   <!-- Mobile Specific Metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <!-- icon fonts -->
   <script src="/js/fontawesome.com_c39cf060d4.js"></script>
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons.css">
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons-ie7.css">
   <!-- Custom css -->
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <!-- js ================================================== -->
   <script src="https://code.jquery.com/jquery.min.js"></script>
   <script src="/assets/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
   <script src="https://unpkg.com/@stackblitz/sdk/bundles/sdk.umd.js"></script>
   <script src="/js/carousel.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>
   <!-- Github buttons. -->
   <script async defer src="https://buttons.github.io/buttons.js"></script>
   <!--iframeResizer-->
  <script src="/assets/js/iframe-resizer.parent.js"></script>
   <!-- Favicons ================================================== -->
  <link rel="icon" type="image/svg+xml" href="/images/restheart logo.svg" />
  <link rel="shortcut icon" href="/images/favicon/favicon.png" />
  <link rel="canonical" href="https://restheart.org/docs/plugins/core-plugins">
  <link rel="alternate" type="application/atom+xml" title="RESTHeart - API Framework" href="https://restheart.org/feed.xml" />
  <script defer data-domain="restheart.org" src="https://plausible.io/js/script.js"></script>
</head>


<body>
    <header id="mainHeader" class="fixed-top background-primary" role="banner">
    <div class="container-fluid">
        <nav class="navbar navbar-default scrollMenu navbar-expand-lg" role="navigation">
            <a class="navbar-brand" href="/">
                <h2 class="text-white"><strong>REST</strong>Heart</h2>
            </a>
            <!-- Place this tag where you want the button to render. -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span
                    class="sr-only">Toggle navigation</span> &#x2630;</button>
            <div class="collapse navbar-collapse navbar-ex1-collapse background-primary" id="scrollTarget">
                <ul class="nav navbar-nav ml-md-auto">
                    <!-- only bounce slack button on home page-->
                    
                    

                    <li class="nav-item ml-1 ml-lg-2 ml-xl-4 mb-0 pb-0 ">
                        <a class="github-button" href="https://github.com/SoftInstigate/restheart" data-size="large" data-show-count="true" aria-label="Star SoftInstigate/restheart on GitHub"></a>
                    </li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/sophia">Ask Sophia</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs">Docs</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/faq">FAQ</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/setup-with-docker/">GET</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/contact">Contacts</a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>



<a  target="_blank" class="gitter-open-chat-button fixed-bottom-right" href="https://join.slack.com/t/restheart/shared_invite/zt-1olrhtoq8-5DdYLBWYDonFGEALhmgSXQ"></a>


    <div class="page-content">
        <div class="container-fluid imgHover doc">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <div class="bd-sidebar__head">
                <div class="dropdown d-flex justify-content-center w-100">
                    <button class="btn btn-secondary dropdown-toggle w-100 p-1 mb-2" type="button"
                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        v8
                    </button>
                    <div class="dropdown-menu mt-2 mr-1 pb-2" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="/docs">
                            
                            <strong>v8</strong>
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v7">
                            
                            v7
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v6">
                            
                            v6
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v5">
                            
                            v5
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v4">
                            
                            v4
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v3">
                            
                            v3
                            
                        </a>
                    </div>
                </div>
                <form action="https://www.google.com/search" class="form bd-sidebar__search d-flex" method="get"
                    name="searchform" target="_blank">
                    <input name="sitesearch" type="hidden" value="restheart.org/docs">
                    <input autocomplete="on" class="form-control input-sm search bd-sidebar__input" name="q"
                        placeholder="Search" required="required" type="text">
                    <button class="bd-sidebar__submit" type="submit">
                        <svg width="16" height="16">
                            <use xlink:href="/images/sprite.svg#search" /></svg>
                    </button>
                </form>
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <a href="https://github.com/SoftInstigate/restheart-website/edit/master/docs/plugins/core-plugins.adoc"
                        class="small mt-2 mb-1 ml-lg-auto"><i class="icon-pencil"></i>Edit Page</a>
                    <button class="btn btn-link bd-sidebar__toggle p-0 mb-1 d-md-none" type="button"
                        data-toggle="collapse" data-target="#bd-sidebar__menu" aria-controls="bd-sidebar__menu"
                        aria-expanded="false" aria-label="Toggle docs navigation">
                        Table of Contents
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30"
                            focusable="false">
                            <title>Menu</title>
                            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22" />
                        </svg>
                    </button>
                </div>
            </div>

            <nav class="bd-sidebar__menu collapse d-md-block" id="bd-sidebar__menu">
                
                    
<a data-toggle="collapse" href="#overview" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2>Overview</h2>
</a>
<ul id="overview" class="collapse">
    <li><a href="/docs/upgrade-to-v8"><strong>Upgrade to v8</strong></a></li>
    <li><a href="/docs">Overview</a></li>
    <li><a href="/docs/faq">FAQ</a></li>
    <li><a href="/docs/mongodb-rest/demo-webapp">Demo WebApp with RESTHeart</a></li>
    <li><a href="/docs/performances">Performances</a></li>
    <li><a href="https://github.com/SoftInstigate/restheart/issues?q=is%3Aissue+is%3Aopen+label%3A%22feature+request%22">Roadmap</a></li>
    <li><a href="/docs/plugins/tutorial">Framework Tutorial</a></li>
    <li><a href="/docs/mongodb-rest/tutorial">REST API Tutorial</a></li>
    <li><a href="/docs/mongodb-graphql/tutorial">GraphQL API Tutorial</a></li>
    <li><a href="/docs/security/tutorial">Auth^2 Tutorial</a></li>
    <li><a href="/docs/example-webapps">Example Web Apps built with RESTHeart</a></li>
    <li><a href="/docs/blog-posts">Blog posts</a></li>
    <li><a href="/docs/video-tutorials">Video Tutorials</a></li>
</ul>

<a data-toggle="collapse" href="#setup" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Setup</h2>
</a>
<ul id="setup" class="collapse">
    <li><a href="/docs/setup"><strong>Setup</strong></a></li>
    <li><a href="/docs/setup-with-docker">Setup with Docker</a></li>
    <li><a href="/docs/configuration">Configuration</a></li>
    <li><a href="/docs/default-configuration">Default Configuration</a></li>
    <li><a href="/docs/security/how-clients-authenticate">Client Authentication Howto</a></li>
    <li><a href="/docs/security/user-management">User Management</a></li>
    <li><a href="/docs/graalvm"><strong>GraalVM</strong></a></li>
    <li><a href="/docs/security/security-hardening"><strong>Security Hardening</strong></a></li>
    <li><a href="/docs/security/tls">Configure TLS</a></li>
    <li><a href="/docs/security/secure-connection-to-mongodb">Secure connection to MongoDB</a></li>
    <li><a href="/docs/proxy">Proxying requests</a></li>
    <li><a href="/docs/static-resources">Serving static resources</a></li>
    <li><a href="/docs/logging">Logging</a></li>
    <li><a href="/docs/monitoring">Monitoring</a></li>
    <li><a href="/docs/auditing">Auditing</a></li>
    <li><a href="/docs/clustering">Clustering &amp; Load Balancing</a></li>
    <li><a href="/docs/enterprise-license">Enterprise License</a></li>
</ul>

<a data-toggle="collapse" href="#framework" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Framework</h2>
</a>
<ul id="framework" class="collapse">
    <!-- <li><a href="/docs/plugins/dev-env">Development Environment</a></li> -->
    <li><a href="/docs/plugins/overview">Overview</a></li>
    <li><a href="/docs/plugins/tutorial">Tutorial</a></li>
    <li><a href="/docs/plugins/deploy">How to deploy Plugins</a></li>
    <h3 id="rest-api" class="mt-2">Base Plugins</h2>
    <li><a href="/docs/plugins/services">Services</a></li>
    <li><a href="/docs/plugins/interceptors">Interceptors</a></li>
    <li><a href="/docs/plugins/providers">Providers</a></li>
    <li><a href="/docs/plugins/initializers">Initializers</a></li>
    <li><a href="/docs/plugins/core-plugins-js">Services and Inteceptors in JavaScript</a></li>
    <h3 id="rest-api" class="mt-2">Security Plugins</h2>
    <li><a href="/docs/security/overview">Overview</a></li>
    <li><a href="/docs/plugins/authentication-mechanisms">Authentication Mechanisms</a></li>
    <li><a href="/docs/plugins/authenticators">Authenticators</a></li>
    <li><a href="/docs/plugins/authorizers">Authorizers</a></li>
    <li><a href="/docs/plugins/token-managers">Token Managers</a></li>
</ul>

<a data-toggle="collapse" href="#security" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Security Plugins</h2>
</a>
<ul id="security" class="collapse">
    <li><a href="/docs/security/tutorial">Auth^2 Tutorial</a></li>
    <li><a href="/docs/security/authentication">Authentication</a></li>
    <li><a href="/docs/security/authorization">Authorization</a></li>
    <li><a href="/docs/security/other-security-plugins">Other Security Plugins</a></li>
</ul>

<a  data-toggle="collapse" href="#mongodb" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">MongoDB Plugins</h2>
</a>
<ul id="mongodb" class="collapse">
    <h3 id="rest-api" class="mt-2">REST API</h2>
    <li><a href="/docs/mongodb-rest/tutorial">Getting Started</a></li>
    <li><a href="/docs/mongodb-rest/read-docs">Reading Documents</a></li>
    <li><a href="/docs/mongodb-rest/write-docs">Writing Documents</a></li>
    <li><a href="/docs/mongodb-rest/files">Managing Binary Files</a></li>
    <li><a href="/docs/mongodb-rest/aggregations">Aggregations</a></li>
    <li><a href="/docs/mongodb-rest/dbs-collections">Databases and Collections</a></li>
    <li><a href="/docs/mongodb-rest/indexes">Indexes</a></li>
    <li><a href="/docs/mongodb-rest/csv">CSV Import</a></li>
    <li><a href="/docs/mongodb-rest/transactions">Transactions</a></li>
    <li><a href="/docs/mongodb-rest/caching">Performance and Caching</a></li>
    <li><a href="/docs/mongodb-rest/relationships">Relationships</a></li>
    <li><a href="/docs/mongodb-rest/json-schema-validation">JSON Schema Validation</a></li>
    <li><a href="/docs/mongodb-rest/resource-uri">Resource URIs</a></li>
    <li><a href="/docs/mongodb-rest/representation-format">Representation Format</a></li>
    <li><a href="/docs/mongodb-rest/etag">ETag</a></li>
    <li><a href="/docs/mongodb-rest/shard-keys">Shard Keys</a></li>
    <li><a href="/docs/mongodb-rest/sample-data">Load Sample Data</a></li>

    <h3 id="rest-api" class="mt-2">GraphQL API</h3>
    <li><a href="/docs/mongodb-graphql/">Overview</a></li>
    <li><a href="/docs/mongodb-graphql/getting-started">Getting Started</a></li>
    <li><a href="/docs/mongodb-graphql/graphql-apps">App Definition</a>
        <ul>
            <li><a href="/docs/mongodb-graphql/schema">Schema Design</a></li>
            <li><a href="/docs/mongodb-graphql/mappings">MongoDB Mappings</a></li>
            <li><a href="/docs/mongodb-graphql/resolvers">Custom Resolvers</a></li>
        </ul>
    </li>
    <li><a href="/docs/mongodb-graphql/tutorial">Basic Tutorial</a></li>
    <li><a href="/docs/mongodb-graphql/complex-app-example">Advanced Example</a></li>
    <li><a href="/docs/mongodb-graphql/optimization">Performance Optimization</a></li>
    <li><a href="/docs/mongodb-graphql/best-practices">Best Practices</a></li>

    <h3 id="rest-api" class="mt-2">Websocket API</h3>
    <li><a href="/docs/mongodb-websocket/">Overview</a></li>
    <li><a href="/docs/mongodb-websocket/change-streams">Streams definition</a></li>
    <li><a href="/docs/mongodb-websocket/variables">Variables</a></li>
    <li><a href="/docs/mongodb-websocket/examples">Examples</a></li>
</ul>

<style>
.collapsing {
    -webkit-transition: none;
    transition: none;
    display: none;
}
</style>

<script type="text/javascript">
    // on page load, show the menu element of the current pages
    const menu = 'framework';
    if (menu) {
        $(`#${menu}`).collapse('show');
    }
</script>

                
            </nav>
        </div>

        <div class="d-none d-xl-block col-xl-2 order-last bd-toc">
            <ul class="sectlevel2">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#dependency-injection">Dependency injection</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#interceptors">Interceptors</a></li>
<li><a href="#initializers">Initializers</a></li>
<li><a href="#providers">Providers</a></li>
</ul>
        </div>
        <div class="col-12 col-md-9 col-xl-8 py-md-3 bd-content">
            <div class="docs-head d-flex align-items-center justify-content-between">
    <h2 class="d-flex align-items-center m-0 pr-3">
        <span>Develop Core Plugins</span>
    </h2>
</div>
            <div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>Plugins allow to extend RESTHeart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Services</strong> extend the API adding web services.</p>
</li>
<li>
<p><strong>Interceptors</strong> snoop and modify requests and responses at different stages of the request lifecycle.</p>
</li>
<li>
<p><strong>Initializers</strong>  execute initialization logic at system startup time.</p>
</li>
<li>
<p><strong>Providers</strong> provide object to other plugins via the <code>@Inject</code> annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible developing security plugins to customize the security layer. Refer to <a href="/docs/plugins/security-plugins">Develop Security Plugins</a> for more information.</p>
</div>
<div class="paragraph">
<p>For code examples of Plugins please refer to <a href="https://github.com/SoftInstigate/restheart/tree/master/examples">RESTHeart Examples</a> repository on GitHub.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=0s">Introduction</a>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="dependency">Dependency</h4>
<div class="paragraph">
<p>The only required dependency to develop a plugin is <code>restheart-commons</code>.</p>
</div>
<div class="paragraph">
<p>With maven:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.restheart<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>restheart-commons<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>VERSION<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registerplugin-annotation">@RegisterPlugin annotation</h4>
<div class="paragraph">
<p>All plugins must be a annotated with <code>@RegisterPlugin</code> to:
- allow RESTHeart to find plugins' implementation classes in deployed jars (see <a href="/docs/plugins/deploy">How to Deploy Plugins</a>)
- specify parameters such us the URI of a <code>Service</code> or the intercept point of an <code>Interceptor</code>.</p>
</div>
<div class="paragraph">
<p>An example follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"just an example service"</span><span class="o">,</span>
    <span class="n">defaultUri</span><span class="o">=</span><span class="s">"/foo"</span><span class="o">,</span>      <span class="c1">// optional, default /&lt;service-name&gt;</span>
    <span class="n">secure</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span>           <span class="c1">// optional, default false</span>
    <span class="n">enabledByDefault</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span> <span class="c1">// optional, default true</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyPlugin</span> <span class="kd">implements</span> <span class="nc">JsonService</span> <span class="o">{</span>
<span class="o">...</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table describes the arguments of the annotation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">param</th>
<th class="tableblock halign-left valign-top">plugin</th>
<th class="tableblock halign-left valign-top">description</th>
<th class="tableblock halign-left valign-top">mandatory</th>
<th class="tableblock halign-left valign-top">default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the name of the plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>none</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">description of the plugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>none</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabledByDefault</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> to enable the plugin; can be overridden by the plugin configuration option <code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultURI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the default URI of the Service; can be overridden by the service configuration option <code>uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/&lt;srv-name&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>matchPolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PREFIX</code> to match request paths starting with <code>/&lt;uri&gt;</code>,<code>EXACT</code> to only match the request path  <code>/&lt;uri&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PREFIX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code> to require successful authentication and authorization to be invoked; can be overridden by the service configuration option <code>secure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dontIntercept</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list of interceptPoints to be executed on requests handled by the service, e.g. <code>dontIntercept = { InterceptPoint.REQUEST_BEFORE_AUTH, InterceptPoint.RESPONSE }</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interceptPoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the intercept point: <code>REQUEST_BEFORE_AUTH</code>, <code>REQUEST_AFTER_AUTH</code>, <code>RESPONSE</code>, <code>RESPONSE_ASYNC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REQUEST_AFTER_AUTH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initPoint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specify when the initializer is executed: <code>BEFORE_STARTUP</code>, <code>AFTER_STARTUP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AFTER_STARTUP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requiresContent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy interceptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only used by Interceptors of proxied resources (the content is always available to Interceptor of Services) Set it to true to make available the content of the request (if interceptPoint is REQUEST_BEFORE_AUTH or REQUEST_AFTER_AUTH) or of the response (if interceptPoint is RESPONSE or RESPONSE_ASYNC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interceptor, initializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the execution priority (less is higher priority)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>blocking</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With blocking = <code>false</code> the execution of the service is not dispatched to a working thread and executed by the io-thread, thus avoiding the overhead of the thread handling and switching.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>authorizerType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorizer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALLOWER</code> can authorize a request unless no <code>VETOER</code> vetoes it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALLOWER</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=108s">Dependencies, annotations and parameters</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="plugin-configuration">Plugin Configuration</h4>
<div class="paragraph">
<p>A plugins has a name as defined by the the <code>@RegisterPlugin</code> annotation. To define a configuration object for a plugin just use its name in the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">ping</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">secure</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">uri</span><span class="pi">:</span> <span class="s">/ping</span>
    <span class="na">msg</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Ping!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>enabled</code> <code>secure</code> and <code>uri</code> are special configuration options that are automatically managed by RESTHeart:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>enabled</strong>: for enabling or disabling the plugin via configuration overwriting the <code>enabledByDefault</code> property of <code>@RegisterPlugin</code></p>
</li>
<li>
<p><strong>uri</strong>: applies to Services to bind them to the URI overwriting the <code>defaultUri</code> property of <code>@RegisterPlugin</code></p>
</li>
<li>
<p><strong>secure</strong>: applies to Services, with <code>secure: true</code> the service request goes thought the authentication and authorization phases, with <code>secure: false</code> the service is fully open.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<code>secure</code> is <code>false</code> by default. If you don&#8217;t specify <code>secure=true</code> your Service is fully open. If your service needs to be protected either define <code>secure=true</code> in the <code>@RegisterPlugin</code> annotation of add a configuration for it with <code>secure: true</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The plugin consumes the configuration with a field annotated with <code>@Inject("conf")</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Inject</span><span class="o">(</span><span class="s">"config"</span><span class="o">)</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">config</span><span class="o">;</span>

<span class="nd">@OnInit</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">ConfigurationException</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">argValue</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">,</span> <span class="s">"msg"</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>argValue()</code> is an helper method to simplify retrieving the value of the configuration argument.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=356s">Plugin configuration</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependency-injection">Dependency injection</h3>
<div class="paragraph">
<p>Available providers allow to inject the following objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Inject("config")</code> - injects the plugins configuration as a <code>Map&lt;String, Object&gt;</code></p>
</li>
<li>
<p><code>@Inject("rh-config")</code> - injects the RESTHeart <code>org.restheart.configuration.Configuration</code> object.</p>
</li>
<li>
<p><code>@Inject("registry")</code> - injects the <code>PluginsRegistry</code> singleton that allows a plugin to get the reference of other plugins.</p>
</li>
<li>
<p><code>@Inject("mclient")</code> - injects the <code>MongoClient</code> object that has been already initialized and connected to MongoDB by the <code>mongo-client-provider</code>.</p>
</li>
<li>
<p><code>@Inject("acl-registry")</code> - injects the ACL registry to define permission programmatically.</p>
</li>
<li>
<p><code>@Inject("gql-app-definition-cache")</code> - injects the <code>LoadingCache&lt;String, GraphQLApp&gt; gqlAppDefsCache</code> object that allows to use the GQL App definition cache to implement custom invalidation logic. Available from v8.0.9.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Inject</span><span class="o">(</span><span class="s">"registry"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">PluginsRegistry</span> <span class="n">registry</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Inject</span><span class="o">(</span><span class="s">"mclient"</span><span class="o">)</span>
<span class="kd">private</span> <span class="nc">MongoClient</span> <span class="n">mclient</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="request-and-response-generic-classes">Request and Response Generic Classes</h4>
<div class="paragraph">
<p><strong>Services</strong> and <strong>Interceptor</strong> are generic classes. They use type parameters for <code>Request</code> and <code>Response</code> classes.</p>
</div>
<div class="paragraph">
<p>Many concrete implementations of specialized <code>Request</code> and <code>Response</code> exist in the <code>org.restheart.exchange</code> package to simplify development:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsonRequest</code> and <code>JsonResponse</code></p>
</li>
<li>
<p><code>BsonRequest</code> and <code>BsonResponse</code></p>
</li>
<li>
<p><code>MongoRequest</code> and <code>MongoResponse</code></p>
</li>
<li>
<p><code>ByteArrayRequest</code> and <code>ByteArrayResponse</code></p>
</li>
<li>
<p><code>StringRequest</code> and <code>StringResponse</code></p>
</li>
<li>
<p><code>BsonFromCsvRequest</code></p>
</li>
<li>
<p><code>UninitializedRequest</code> and <code>UninitializedResponse</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those implementations differ on the data type used to hold the request and response content. For example, <code>ByteArrayRequest</code> and <code>BsonRequest</code> hold content as <code>byte[]</code> and <code>BsonValue</code> respectively.</p>
</div>
<div class="paragraph">
<p>Different implementation can also provide some helper methods to cope with specific request parameter. For instance, the <code>MongoRequest</code>, i.e. the request used by the MongoService, has the method <code>getPageSize()</code> because this is a query parameter used by that service.</p>
</div>
<div class="paragraph">
<p>When a request hits RESTHeart, it determines which service will handle it. The Service implementation is responsible of instantiating the correct Request and Response objects that will be used along the whole exchange processing chain.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="services">Services</h3>
<div class="paragraph">
<p>Depending on the content type, the Service class implements one of the specialized <code>org.restheart.plugins.Service</code> interfaces. The following implementation are provided by <code>restheart-commons</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ByteArrayService</code></p>
</li>
<li>
<p><code>JsonService</code></p>
</li>
<li>
<p><code>BsonService</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code of example <a href="https://github.com/SoftInstigate/restheart/tree/master/examples/mongo-status-service">mongo-status-service</a> implementing <code>BsonService</code> and using the <code>MongoClient</code> obtained via <code>@Inject("mclient")</code> follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RegisterPlugin</span><span class="o">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">"serverstatus"</span><span class="o">,</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s">"returns MongoDB serverStatus"</span><span class="o">,</span>
        <span class="n">enabledByDefault</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
        <span class="n">defaultURI</span> <span class="o">=</span> <span class="s">"/status"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MongoServerStatusService</span> <span class="kd">implements</span> <span class="nc">BsonService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOGGER</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">MongoServerStatusService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Inject</span><span class="o">(</span><span class="s">"mclient"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">MongoClient</span> <span class="n">mongoClient</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BsonDocument</span> <span class="no">COMMAND</span> <span class="o">=</span> <span class="n">document</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"serverStatus"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="nc">BsonRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">BsonResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isGet</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">var</span> <span class="n">serverStatus</span> <span class="o">=</span> <span class="n">mongoClient</span><span class="o">.</span><span class="na">getDatabase</span><span class="o">(</span><span class="s">"admin"</span><span class="o">).</span><span class="na">runCommand</span><span class="o">(</span><span class="no">COMMAND</span><span class="o">,</span> <span class="nc">BsonDocument</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

            <span class="n">response</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">serverStatus</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentTypeAsJson</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// Any other HTTP verb is a bad request</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">SC_BAD_REQUEST</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The key method is <code>handle()</code> that is executed when a request to the service URI hits RESTHeart.</p>
</div>
<div class="sect3">
<h4 id="create-service-with-custom-generic-type">Create Service with custom generic type</h4>
<div class="paragraph">
<p>To implement a Service that handles different types of Request and Response, it must implement the base <code>Service</code> interface.</p>
</div>
<div class="paragraph">
<p>The base <code>Service</code> interface requires to implement methods to initialize and retrieve the Request and Response objects.</p>
</div>
<div class="paragraph">
<p>The following example shows how to handle XML content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"myXmlService"</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"example service consuming XML requests"</span><span class="o">,</span>
    <span class="n">enabledByDefault</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
    <span class="n">defaultURI</span> <span class="o">=</span> <span class="s">"/xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyXmlService</span> <span class="kd">implements</span> <span class="nc">Service</span><span class="o">&lt;</span><span class="nc">XmlRequest</span><span class="o">,</span> <span class="nc">XmlResponse</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">&gt;</span> <span class="nf">requestInitializer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlRequest</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">&gt;</span> <span class="nf">responseInitializer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlResponse</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">,</span> <span class="nc">JsonRequest</span><span class="o">&gt;</span> <span class="nf">request</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">,</span> <span class="nc">JsonResponse</span><span class="o">&gt;</span> <span class="nf">response</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example follows a pattern that delegates the actual initialization (in <code>requestInitializer()</code> and <code>responseInitializer()</code>) and retrieval of the object from the exchange (in <code>request()</code> and <code>response()</code>) to the concrete class, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlRequest</span> <span class="kd">extends</span> <span class="nc">ServiceRequest</span><span class="o">&lt;</span><span class="nc">Document</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nf">XmlRequest</span><span class="o">(</span><span class="nc">HttpServerExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">XmlRequest</span> <span class="nf">init</span><span class="o">(</span><span class="nc">HttpServerExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">ret</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XmlRequest</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">ret</span><span class="o">.</span><span class="na">injectContent</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">ieo</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ret</span><span class="o">.</span><span class="na">setInError</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">XmlRequest</span> <span class="nf">of</span><span class="o">(</span><span class="nc">HttpServerExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">of</span><span class="o">(</span><span class="n">exchange</span><span class="o">,</span> <span class="nc">XmlRequest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">injectContent</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SAXException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">dBuilder</span> <span class="o">=</span> <span class="nc">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">rawContent</span> <span class="o">=</span> <span class="nc">ChannelReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">wrapped</span><span class="o">.</span><span class="na">getRequestChannel</span><span class="o">());</span>

        <span class="n">setContent</span><span class="o">(</span><span class="n">dBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">rawContent</span><span class="o">)</span><span class="n">ml</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the constructor a call to <code>super(exchange)</code> attaches the object to the <code>HttpServerExchange</code>. The object is retrieved using the inherited <code>of()</code> method that gets the instance attachment from the <code>HttpServerExchange</code>. This is fundamental for two reasons: first the same request and response objects must be shared by the all handlers of the processing chain. Second, this avoid the need to parse the content several times for performance reasons.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=680s">Services</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="interceptors">Interceptors</h3>
<div class="paragraph">
<p>Interceptors allow to snoop and modify requests and responses at different
stages of the request lifecycle as defined by the interceptPoint parameter of
the annotation <code>@RegisterPlugin</code>.</p>
</div>
<div class="paragraph">
<p>An interceptor can intercept either proxied requests or requests handled by Services.</p>
</div>
<div class="paragraph">
<p>An interceptor, but <code>WildcardInterceptor</code>, can intercept requests handled by a Service when its request and response types are equal to the ones declared by the Service.</p>
</div>
<div class="paragraph">
<p>An interceptor can intercept a proxied request, when its request and response
types extends <code>BufferedRequest</code> and <code>BufferedResponse</code>.</p>
</div>
<div class="paragraph">
<p>The following implementation are provided by <code>restheart-commons</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>WildcardInterceptor</code> intercepts requests handled by any service</p>
</li>
<li>
<p><code>ByteArrayInterceptor</code> intercepts requests handled by services implementing <code>ByteArrayService</code></p>
</li>
<li>
<p><code>JsonInterceptor</code> intercepts requests handled by services implementing <code>JsonService</code></p>
</li>
<li>
<p><code>BsonInterceptor</code> intercepts requests handled by services implementing <code>BsonService</code></p>
</li>
<li>
<p><code>MongoInterceptor</code> intercepts requests handled by the MongoService</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last one is particularly useful as it allows intercepting requests to the MongoDb API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"secretFilter"</span><span class="o">,</span>
    <span class="n">interceptPoint</span> <span class="o">=</span> <span class="nc">InterceptPoint</span><span class="o">.</span><span class="na">RESPONSE</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"removes the property 'secret' from GET /coll"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReadOnlyPropFilter</span> <span class="kd">implements</span> <span class="nc">MongoInterceptor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="nc">MongoRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">MongoResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">isDocument</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">asDocument</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="s">"secret"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">isArray</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">asArray</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">doc</span> <span class="o">-&gt;</span> <span class="n">doc</span><span class="o">.</span><span class="na">asDocument</span><span class="o">())</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">doc</span> <span class="o">-&gt;</span> <span class="n">doc</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"secret"</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">resolve</span><span class="o">(</span><span class="nc">MongoRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">MongoResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">isGet</span><span class="o">()</span>
            <span class="o">&amp;&amp;</span> <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span>
            <span class="o">&amp;&amp;</span> <span class="s">"coll"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getCollectionName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>handle()</code> method is invoked only if the <code>resolve()</code> method returns true.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=986s">Interceptors</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="initializers">Initializers</h3>
<div class="paragraph">
<p>An <em>Initializer</em> allows executing custom logic at startup time.</p>
</div>
<div class="paragraph">
<p>The Initializer implementation class must extend the <code>org.restheart.plugins.Initializer</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Initializer</span> <span class="kd">extends</span> <span class="nc">ConfigurablePlugin</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the following code the Initializer hangs restheart startup until the user confirms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"confirmStartupInitializer"</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"hangs restheart startup until the user hits &lt;enter&gt;"</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span>
    <span class="n">initPoint</span> <span class="o">=</span> <span class="nc">InitPoint</span><span class="o">.</span><span class="na">BEFORE_STARTUP</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">confirmStartupInitializer</span> <span class="kd">implements</span> <span class="nc">Initializer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hit &lt;enter&gt; to start RESTHeart"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">console</span><span class="o">().</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=1274s">Initializers</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="providers">Providers</h3>
<div class="paragraph">
<p><code>@Inject</code> works together with the plugin type <code>Provider</code>, as in the following example:</p>
</div>
<div class="paragraph">
<p>Given the following <code>Provider</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">RegisterPlugin</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"hello-world-message"</span><span class="o">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"a dummy provider"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MyProvider</span> <span class="kd">implements</span> <span class="nc">Provider</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">get</span><span class="o">(</span><span class="nc">PluginRecord</span><span class="o">&lt;?&gt;</span> <span class="n">caller</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Hello World!"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can inject it into a Plugin with the <code>@Inject</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"greetings"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"just another Hello World"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreeterService</span> <span class="kd">implements</span> <span class="nc">JsonService</span> <span class="o">{</span>
    <span class="nd">@Inject</span><span class="o">(</span><span class="s">"hello-world-message"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="nd">@OnInit</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// called after all @Inject fields are resolved</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="nc">JsonRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">JsonResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">switch</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">getMethod</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">case</span> <span class="no">GET</span> <span class="o">-&gt;</span> <span class="n">res</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">object</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="n">message</span><span class="o">));</span>
            <span class="k">case</span> <span class="no">OPTIONS</span> <span class="o">-&gt;</span> <span class="n">handleOptions</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
            <span class="k">default</span> <span class="o">-&gt;</span> <span class="n">res</span><span class="o">.</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">SC_METHOD_NOT_ALLOWED</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
        </div>
    </div>
</div>
    </div>

    <footer class="bs-docs-footer mt-0">
  <!-- <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script> -->
  <div id="fb-root"></div>
  <section id="mainFooter">
    <div class="container-fluid">
      <div>
        <div class="bs-docs-social">
          <ul class="socialNetwork">
            <li class="ml-auto">
              <a href="https://twitter.com/softinstigate" class="tips" title="Follow us on Twitter" data-original-title="follow us on Twitter"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#twitter" /></svg>
              </a>
            </li>
            <li>
              <a href="https://github.com/softinstigate/restheart" class="tips" title="Get the source code" data-original-title="get the source code"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#github" /></svg>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div>
        Made with
        <!--<span class="glyphicon glyphicon-heart"></span>-->
        <svg class="footer__like"><use xlink:href="/images/sprite.svg#like" /></svg>
        by
        <a href="https://www.softinstigate.com" target="_blank">SoftInstigate</a>
      </div>
      <div>
        <a href="https://softinstigate.com/en/privacy" class="mr-2 small">Privacy Policy</a>
        <a href="https://www.iubenda.com/privacy-policy/15571002/cookie-policy" class="small iubenda-nostyle no-brand iubenda-embed " title="Cookie Policy">Cookie Policy</a>
      </div>
    </section>
</footer>

    <!-- End Document ================================================== -->
</body>

</html>
<!-- add copy button on code snippet -->
<script src="/assets/js/clipboard.min.js"></script>
<style>
    .listingblock:hover .clipboard {
        display: block;
    }

    .clipboard {
        display: none;
        border: 0;
        font-size: .75em;
        text-transform: uppercase;
        font-weight: 800;
        padding: 2px;
        color: #999;
        position: absolute;
        top: 6px;
        right: 10px;
        background: transparent;
    }

    code + .clipboard {
        padding: 0;
    }

    .clipboard:hover, .clipboard:focus, .clipboard:active {
        outline: 0;
        color: white;
        /* background-color: #eee9e6; */
    }
</style>
<!-- add copy button on code snippet -->
<script>
    window.onload = function() {
        function target(b) {
            var p = b.parentNode;
            if (p.className.includes("highlight")) {
                var elems = p.getElementsByTagName("code");
                if (elems.length > 0) {
                    return elems[0];
                }
            }
            return p.childNodes[0];
        }

        var pre = document.getElementsByTagName('pre');
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copy';
            // b.innerHTML = '<i style="font-size:18px" class="icon-clipboard"></i>';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }

        var clipboard = new ClipboardJS('.clipboard', {
            // this custom text function, remove any line that doesn't start with $
            text: function (trigger) {
                var t = target(trigger);
                const text = target(trigger).outerText;

                if (text) {
                    const dataLang = t.getAttribute('data-lang');
                    if (dataLang === 'bash') {
                        return text
                            .replace(/^(?!\$.*$).*/gm, '') // remove lines that don't start with $
                            .replace(/^\$ */gm, '') // remove leading $
                            .replace(/^\s*[\r\n]/gm, '') // remove blank lines
                            .replace(/^\s+|\s+$/gm, ''); // trim string
                    }
                }
            },
            target: target
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copied';
            setTimeout(function() {
                e.trigger.textContent = 'Copy';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>