<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->

<html lang="en">
<!--<![endif]-->
<head>
   <meta charset="utf-8">
   <title>RESTHeart - Users provisioning how-to</title>
   <meta name="description" content="Low code API Framework for MongoDB">
   <meta name="author" content="SoftInstigate srl">
   <meta name="keywords" content="restheart,mongodb,rest,,graphql,api,http,microservice,java,framework">
   <!-- Open Graph -->
   <meta property="og:type" content="website">
   <meta property="og:url" content="https://restheart.org">
   <meta property="og:logo" content="/images/restheart logo.svg">
   <meta property="og:title" content="RESTHeart - Users provisioning how-to">
   <meta property="og:description" content="Low code API Framework for MongoDB">
   <meta property="og:locale" content="en">
   
   <!-- avoid search engine indexing of old documentation pages  -->
   <meta name="robots" content="noindex,nofollow">
   
   <!-- Mobile Specific Metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <!-- icon fonts -->
   <script src="/js/fontawesome.com_c39cf060d4.js"></script>
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons.css">
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons-ie7.css">
   <!-- Custom css -->
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <!-- js ================================================== -->
   <script src="https://code.jquery.com/jquery.min.js"></script>
   <script src="/assets/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
   <script src="https://unpkg.com/@stackblitz/sdk/bundles/sdk.umd.js"></script>
   <script src="/js/carousel.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>
   <!-- Github buttons. -->
   <script async defer src="https://buttons.github.io/buttons.js"></script>
   <!--iframeResizer-->
  <script src="/assets/js/iframe-resizer.parent.js"></script>
   <!-- Favicons ================================================== -->
  <link rel="icon" type="image/svg+xml" href="/images/restheart logo.svg" />
  <link rel="shortcut icon" href="/images/favicon/favicon.png" />
  <link rel="canonical" href="https://restheart.org/docs/v3/users-provisioning">
  <link rel="alternate" type="application/atom+xml" title="RESTHeart - API Framework" href="https://restheart.org/feed.xml" />
  <script defer data-domain="restheart.org" src="https://plausible.io/js/script.js"></script>
</head>


<body>
    <header id="mainHeader" class="fixed-top background-primary" role="banner">
    <div class="container-fluid">
        <nav class="navbar navbar-default scrollMenu navbar-expand-lg" role="navigation">
            <a class="navbar-brand" href="/">
                <h2 class="text-white"><strong>REST</strong>Heart</h2>
            </a>
            <!-- Place this tag where you want the button to render. -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span
                    class="sr-only">Toggle navigation</span> &#x2630;</button>
            <div class="collapse navbar-collapse navbar-ex1-collapse background-primary" id="scrollTarget">
                <ul class="nav navbar-nav ml-md-auto">
                    <!-- only bounce slack button on home page-->
                    
                    

                    <li class="nav-item ml-1 ml-lg-2 ml-xl-4 mb-0 pb-0 ">
                        <a class="github-button" href="https://github.com/SoftInstigate/restheart" data-size="large" data-show-count="true" aria-label="Star SoftInstigate/restheart on GitHub"></a>
                    </li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/sophia">Ask Sophia</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs">Docs</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/faq">FAQ</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/setup-with-docker/">GET</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/contact">Contacts</a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>

<div class="alert alert-warning m-0 text-center" role="alert">
    <strong>RESTHeart 8 is the current stable release. Switch documentation to <a href="/docs">v8</a></strong>
</div>



<a  target="_blank" class="gitter-open-chat-button fixed-bottom-right" href="https://join.slack.com/t/restheart/shared_invite/zt-1olrhtoq8-5DdYLBWYDonFGEALhmgSXQ"></a>


    <div class="page-content">
        <div class="container-fluid imgHover doc">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <div class="bd-sidebar__head">
                <div class="dropdown d-flex justify-content-center w-100">
                    <button class="btn btn-secondary dropdown-toggle w-100 p-1 mb-2" type="button"
                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        v3
                    </button>
                    <div class="dropdown-menu mt-2 mr-1 pb-2" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="/docs">
                            
                            v8
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v7">
                            
                            v7
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v6">
                            
                            v6
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v5">
                            
                            v5
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v4">
                            
                            v4
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v3">
                            
                            <strong>v3</strong>
                            
                        </a>
                    </div>
                </div>
                <form action="https://www.google.com/search" class="form bd-sidebar__search d-flex" method="get"
                    name="searchform" target="_blank">
                    <input name="sitesearch" type="hidden" value="restheart.org/docs">
                    <input autocomplete="on" class="form-control input-sm search bd-sidebar__input" name="q"
                        placeholder="Search" required="required" type="text">
                    <button class="bd-sidebar__submit" type="submit">
                        <svg width="16" height="16">
                            <use xlink:href="/images/sprite.svg#search" /></svg>
                    </button>
                </form>
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <a href="https://github.com/SoftInstigate/restheart-website/edit/master/docs/v3/users-provisioning.md"
                        class="small mt-2 mb-1 ml-lg-auto"><i class="icon-pencil"></i>Edit Page</a>
                    <button class="btn btn-link bd-sidebar__toggle navbar-expand-md p-0 mb-1 d-md-none" type="button"
                        data-toggle="collapse" data-target="#bd-sidebar__menu" aria-controls="bd-sidebar__menu"
                        aria-expanded="false" aria-label="Toggle docs navigation">
                        Table of Contents
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30"
                            focusable="false">
                            <title>Menu</title>
                            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10"
                                d="M4 7h22M4 15h22M4 23h22" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="bd-sidebar__menu collapse d-md-block" id="bd-sidebar__menu">
                
                    <h2 id="installation-and-configuration">Installation and Configuration</h2>
<ul>
    <li><a href="/docs/v3/setup">Setup</a></li>
    <li><a href="/docs/v3/configuration-file">Configuration File</a></li>
    <li><a href="/docs/v3/security">Security</a></li>
    <li><a href="/docs/v3/roadmap">Roadmap</a></li>
</ul>

<h2 id="api">API</h2>
<ul>
    <li><a href="/docs/v3/tutorial">Tutorial</a></li>
    <li><a href="/docs/v3/resource-uri">Resource URIs</a></li>
    <li><a href="/docs/v3/representation-format">Representation Format</a></li>
    <li><a href="/docs/v3/quick-reference">Quick Rererence</a></li>
    <li><a href="/docs/v3/query-documents">Query Documents</a></li>
    <li><a href="/docs/v3/write-requests">Write Requests</a></li>
    <li><a href="/docs/v3/files-buckets">Files Bucket (GridFS)</a></li>
    <li><a href="/docs/v3/indexes">Collection Indexes</a></li>
    <li><a href="/docs/v3/etag">ETag</a></li>
    <li><a href="/docs/v3/shard-keys">Shard Keys</a></li>
</ul>

<h2 id="advanced-topics">Advanced Topics</h2>
<ul>
    <li><a href="/docs/v3/aggregations">Aggregations</a></li>
    <li><a href="/docs/v3/request-transformers">Request Transformers</a></li>
    <li><a href="/docs/v3/request-checkers">Request Checkers</a></li>
    <li><a href="/docs/v3/json-schema-validation">Document validation with JSON schema</a></li>
    <li><a href="/docs/v3/application-logic">Application Logic</a></li>
    <li><a href="/docs/v3/initializer">Initializer</a></li>
    <li><a href="/docs/v3/request-hooks">Request Hooks</a></li>
    <li><a href="/docs/v3/relationships">Relationships</a></li>
    <li><a href="/docs/v3/custom-code-packaging-howto">How to package custom code</a></li>
</ul>

<h2 id="misc">Misc</h2>
<ul>
    <li><a href="/docs/v3/cors-support">CORS Support</a></li>
    <li><a href="/docs/v3/requests-metrics">Metrics on Requests</a></li>
    <li><a href="/docs/v3/speedup-requests-with-cursor-pools">Speedup Requests with Cursor Pools</a></li>
    <li><a href="/docs/v3/performances">Performances</a></li>
    <li><a href="/docs/v3/example-angularjs-app">An example AngularJs application</a></li>
    <li><a href="/docs/v3/opentracing">Opentracing / zipkin headers support</a></li>
</ul>
                
            </div>
        </div>
        <div class="d-none d-xl-block col-xl-2 order-last bd-toc">

  <ul>
    <li><a href="#introduction">Introduction </a></li>
    <li><a href="#steps">Steps</a>
      <ul>
        <li><a href="#configure-restheart-to-use-thedbidentitymanager">1. Configure RESTHeart to use the DbIdentityManager</a></li>
        <li><a href="#configure-the-mandatorysecurityyml-file">2. Configure the mandatory security.yml file</a></li>
        <li><a href="#create-the-javascript-file">3. Create the Javascript file</a></li>
        <li><a href="#create-all-the-users-via-mongo-shell">4. Create all the users via mongo shell</a></li>
        <li><a href="#check-the-database-and-collection">5. Check the database and collection</a></li>
        <li><a href="#start-restheart">6. Start RESTHeart</a></li>
        <li><a href="#check-the-admins-roles">7. Check the admin’s roles</a></li>
        <li><a href="#replace-the-temporary-password">8. Replace the temporary password</a></li>
        <li><a href="#get-the-final-document">9. GET the final document</a></li>
        <li><a href="#create-another-user">10. Create another user</a></li>
        <li><a href="#check-the-new-user">11. Check the new user</a></li>
      </ul>
    </li>
  </ul>

</div>
<div class="col-12 col-md-9 col-xl-8 py-md-3 bd-content">

  <div class="docs-head d-flex align-items-center justify-content-between">
    <h2 class="d-flex align-items-center m-0 pr-3">
        <span>Users provisioning how-to</span>
    </h2>
</div>

  <h2 id="introduction">Introduction </h2>

  <p>RESTHeart offers a couple of options for authenticating users:</p>

  <ol>
    <li>The <code class="language-plaintext highlighter-rouge">SimpleFileIdentityManager</code> authenticates users defined in the
default yaml <strong>configuration file</strong>.</li>
    <li>The <code class="language-plaintext highlighter-rouge">DbIdentityManager</code> authenticates users defined in a <strong>MongoDB
collection</strong>.</li>
  </ol>

  <p>Option # 1 is static, as the configuration file is read at startup and
can’t be changed. In real applications it’s often mandatory to switch to
option # 2 and manage users dynamically into the database. However, if
RESTheart is started with the <code class="language-plaintext highlighter-rouge">DbIdentityManager</code> configuration then it
needs at least one user already present in the database or it aborts
immediately. The way to achieve this is to seed the database in advance,
provisioning the very first administrative user in the right MongoDB
collection so that RESTHeart can start-up properly.</p>

  <h2 id="steps">Steps</h2>

  <h3 id="configure-restheart-to-use-thedbidentitymanager">1. Configure RESTHeart to use the <code class="language-plaintext highlighter-rouge">DbIdentityManager</code></h3>

  <p>Edit the usual <code class="language-plaintext highlighter-rouge">restheart.yml</code> file (below is a fragment):</p>

  <p><strong>restheart.yml (fragment)</strong></p>

  <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
idm:
    implementation-class: org.restheart.security.impl.DbIdentityManager
    conf-file: ./etc/security.yml
access-manager:
    implementation-class: org.restheart.security.impl.SimpleAccessManager
    conf-file: ./etc/security.yml
...
</code></pre></div>  </div>

  <h3 id="configure-the-mandatorysecurityyml-file">2. Configure the mandatory <code class="language-plaintext highlighter-rouge">security.yml</code> file</h3>

  <p>Create some roles as needed. In this case users will be stored under the
<code class="language-plaintext highlighter-rouge">users</code> collection of the <code class="language-plaintext highlighter-rouge">auth</code> database, but names are arbitrary.</p>

  <p><strong>security.yml</strong></p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## RESTHeart example security configuration file.</span>
<span class="nt">---</span>
<span class="c">## Configuration for db based Identity Manager</span>
dbim:
    - db: auth
      coll: <span class="nb">users
      </span>cache-enabled: <span class="nb">false
      </span>cache-size: 1000
      cache-ttl: 60000
      cache-expire-policy: AFTER_WRITE
 
<span class="c"># Users with role 'ADMIN' can do anything</span>
permissions:
    - role: ADMIN
      predicate: path-prefix[path<span class="o">=</span><span class="s2">"/"</span><span class="o">]</span>
    - role: OPERATOR
      predicate: path-prefix[path<span class="o">=</span><span class="s2">"/myapp"</span><span class="o">]</span>
    - role: USER
      predicate: path-prefix[path<span class="o">=</span><span class="s2">"/myapp"</span><span class="o">]</span>

<span class="c"># Not authenticated user can only GET any resource under the /public URI</span>
    - role: <span class="nv">$unauthenticated</span>
      predicate: path-prefix[path<span class="o">=</span><span class="s2">"/public"</span><span class="o">]</span> and method[value<span class="o">=</span><span class="s2">"GET"</span><span class="o">]</span>
</code></pre></div>  </div>

  <h3 id="create-the-javascript-file">3. Create the Javascript file</h3>

  <p>This is necessary to insert the administrative user into MongoDB. Let’s
call it “admin”</p>

  <p>The first line tells MongoDB to use the same database name as it was
configured in the <code class="language-plaintext highlighter-rouge">dbim</code> section of the above configuration file, in
this case the db is called “auth”:</p>

  <pre><code class="language-plain">dbim:
    - db: auth
...
</code></pre>

  <p>Start the mongo shell and insert the administrative user by hand or edit
a file if you want to create multiple users at ht e same time:</p>

  <p><strong>users.js</strong></p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use auth<span class="p">;</span> 
db.users.insert<span class="o">({</span> _id: <span class="s2">"admin"</span>, password: <span class="s2">"temp"</span>, roles: <span class="o">[</span><span class="s1">'ADMIN'</span><span class="o">]</span> <span class="o">})</span><span class="p">;</span>
...
</code></pre></div>  </div>

  <p>Pay attention to the <code class="language-plaintext highlighter-rouge">roles</code> array in the above Javascript statement:
its content must exactly match the role names in the <code class="language-plaintext highlighter-rouge">permissions</code>
section of the yaml configuration file or it won’t work.</p>

  <h3 id="create-all-the-users-via-mongo-shell">4. Create all the users via mongo shell</h3>

  <p>In this example MongoDB runs at IP 192.168.99.100 (it’s a Docker
container). You might want to replace the address with <code class="language-plaintext highlighter-rouge">localhost</code> or
whatever.</p>

  <p>The command below creates the <code class="language-plaintext highlighter-rouge">auth</code> database and the <code class="language-plaintext highlighter-rouge">admin</code> user in
one shot.</p>

  <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mongo 192.168.99.100:27017/auth users.js
MongoDB shell version: 3.0.7
connecting to: 192.168.99.100:27017/auth
</code></pre></div>  </div>

  <h3 id="check-the-database-and-collection">5. Check the database and collection</h3>

  <p>For example with the following two shell commands it’s possible to check
database names and list the users collection of the auth database:</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mongo <span class="nt">--host</span> 192.168.99.100 <span class="nt">--eval</span> <span class="s2">"printjson(db.adminCommand('listDatabases'))"</span>
<span class="o">{</span>
    <span class="s2">"databases"</span> : <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"name"</span> : <span class="s2">"auth"</span>,
            <span class="s2">"sizeOnDisk"</span> : 65536,
            <span class="s2">"empty"</span> : <span class="nb">false</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"name"</span> : <span class="s2">"local"</span>,
            <span class="s2">"sizeOnDisk"</span> : 32768,
            <span class="s2">"empty"</span> : <span class="nb">false</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"totalSize"</span> : 98304,
    <span class="s2">"ok"</span> : 1
<span class="o">}</span>
 
<span class="nv">$ </span>mongo auth <span class="nt">--host</span> 192.168.99.100 <span class="nt">--eval</span> <span class="s2">"db.users.find();"</span>
MongoDB shell version: 3.2.1

connecting to: auth

<span class="o">{</span> <span class="s2">"_id"</span> : <span class="s2">"admin"</span>, <span class="s2">"password"</span> : <span class="s2">"temp"</span>, <span class="s2">"roles"</span> : <span class="o">[</span> <span class="s2">"ADMIN"</span> <span class="o">]</span> <span class="o">}</span>
...
</code></pre></div>  </div>

  <h3 id="start-restheart">6. Start RESTHeart</h3>

  <p>Start RESTHeart as you would usually do. Logs must be clean, like below:</p>

  <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>16:31:10.242 [main] INFO  org.restheart.Bootstrapper - Starting RESTHeart
16:31:10.255 [main] INFO  org.restheart.Bootstrapper - version 1.1.3
16:31:10.270 [main] INFO  org.restheart.Bootstrapper - Logging to console with level INFO
16:31:10.580 [main] INFO  org.restheart.Bootstrapper - MongoDB connection pool initialized
16:31:10.580 [main] INFO  org.restheart.Bootstrapper - MongoDB version 3.2.0
16:31:10.856 [main] INFO  org.restheart.Bootstrapper - Token based authentication enabled with token TTL 15 minutes
16:31:11.130 [main] INFO  org.restheart.Bootstrapper - HTTPS listener bound at 0.0.0.0:4443
16:31:11.134 [main] INFO  org.restheart.Bootstrapper - HTTP listener bound at 0.0.0.0:8080
16:31:11.138 [main] INFO  org.restheart.Bootstrapper - Local cache for db and collection properties enabled
16:31:11.203 [main] INFO  org.restheart.Bootstrapper - URL / bound to MongoDB resource *
16:31:11.372 [main] INFO  org.restheart.Bootstrapper - Embedded static resources browser extracted in /tmp/restheart-5012079845495337850
16:31:11.395 [main] INFO  org.restheart.Bootstrapper - URL /browser bound to static resources browser. access manager: false
16:31:11.398 [main] INFO  org.restheart.Bootstrapper - URL /_logic/ping bound to application logic handler org.restheart.handlers.applicationlogic.PingHandler. access manager: false
16:31:11.402 [main] INFO  org.restheart.Bootstrapper - URL /_logic/roles bound to application logic handler org.restheart.handlers.applicationlogic.GetRoleHandler. access manager: false
16:31:11.727 [main] INFO  org.restheart.Bootstrapper - Pid file /var/run/restheart--1441246088.pid
16:31:11.731 [main] INFO  org.restheart.Bootstrapper - RESTHeart started
</code></pre></div>  </div>

  <h3 id="check-the-admins-roles">7. Check the admin’s roles</h3>

  <p>For example with the <a href="https://httpie.org">httpie</a> client, get
the <code class="language-plaintext highlighter-rouge">/_logic/roles/admin</code> resource which shows user’s roles</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>http <span class="nt">-a</span> admin:temp 192.168.99.100/_logic/roles/admin
 
HTTP/1.1 200 OK
Access-Control-Allow-Credentials: <span class="nb">true
</span>Access-Control-Allow-Origin: <span class="k">*</span>
Access-Control-Expose-Headers: Location, ETag, Auth-Token, Auth-Token-Valid-Until, Auth-Token-Location, X-Powered-By
Auth-Token: ee46be56-fdd1-48e6-afa2-934f114ab882
Auth-Token-Location: /_authtokens/admin
Auth-Token-Valid-Until: 2016-01-07T16:49:29.194Z
Connection: keep-alive
Content-Encoding: <span class="nb">gzip
</span>Content-Length: 108
Content-Type: application/hal+json
Date: Thu, 07 Jan 2016 16:34:29 GMT
X-Powered-By: restheart.org
<span class="o">{</span>
    <span class="s2">"_links"</span>: <span class="o">{</span>
        <span class="s2">"self"</span>: <span class="o">{</span>
            <span class="s2">"href"</span>: <span class="s2">"/_logic/roles/admin"</span>
        <span class="o">}</span>
    <span class="o">}</span>, 
    <span class="s2">"authenticated"</span>: <span class="nb">true</span>, 
    <span class="s2">"roles"</span>: <span class="o">[</span>
        <span class="s2">"ADMIN"</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <h3 id="replace-the-temporary-password">8. Replace the temporary password</h3>

  <p>The “temp” password in the users.js file is really temporary, just set a
better one. Say for example “12345”, which is actually not much better,
but it’s an example :)</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>http <span class="nt">-a</span> admin:temp <span class="nt">-j</span> PATCH 192.168.99.100/auth/users/admin <span class="nv">password</span><span class="o">=</span>12345

HTTP/1.1 409 Conflict
Access-Control-Allow-Credentials: <span class="nb">true
</span>Access-Control-Allow-Origin: <span class="k">*</span>
Access-Control-Expose-Headers: Location, ETag, Auth-Token, Auth-Token-Valid-Until, Auth-Token-Location, X-Powered-By
Auth-Token: ee46be56-fdd1-48e6-afa2-934f114ab882
Auth-Token-Location: /_authtokens/admin
Auth-Token-Valid-Until: 2016-01-07T16:52:57.209Z
Connection: keep-alive
Content-Encoding: <span class="nb">gzip
</span>Content-Length: 167
Content-Type: application/hal+json
Date: Thu, 07 Jan 2016 16:37:57 GMT
ETag: 568e9465c9e77c000646e830
X-Powered-By: restheart.org
<span class="o">{</span>
    <span class="s2">"_links"</span>: <span class="o">{</span>
        <span class="s2">"self"</span>: <span class="o">{</span>
            <span class="s2">"href"</span>: <span class="s2">"/auth/users/admin"</span>
        <span class="o">}</span>
    <span class="o">}</span>, 
    <span class="s2">"http status code"</span>: 409, 
    <span class="s2">"http status description"</span>: <span class="s2">"Conflict"</span>, 
    <span class="s2">"message"</span>: <span class="s2">"The document's ETag must be provided using the 'If-Match' header"</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <h3 id="get-the-final-document">9. GET the final document</h3>

  <p>Don’t forget to authenticate now using the <strong>new password</strong>! Check that
the output is similar to below and you have a proper ETag (“_etag” key)</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>http <span class="nt">-a</span> admin:12345 192.168.99.100/auth/users/admin

HTTP/1.1 200 OK
Access-Control-Allow-Credentials: <span class="nb">true
</span>Access-Control-Allow-Origin: <span class="k">*</span>
Access-Control-Expose-Headers: Location, ETag, Auth-Token, Auth-Token-Valid-Until, Auth-Token-Location, X-Powered-By
Auth-Token: df20de0a-f9ba-40dc-a659-86031f501509
Auth-Token-Location: /_authtokens/admin
Auth-Token-Valid-Until: 2016-01-07T18:18:18.526Z
Connection: keep-alive
Content-Encoding: <span class="nb">gzip
</span>Content-Length: 154
Content-Type: application/hal+json
Date: Thu, 07 Jan 2016 18:03:18 GMT
ETag: 568e9465c9e77c000646e830
X-Powered-By: restheart.org
<span class="o">{</span>
    <span class="s2">"_etag"</span>: <span class="o">{</span>
        <span class="s2">"</span><span class="nv">$oid</span><span class="s2">"</span>: <span class="s2">"568e9465c9e77c000646e830"</span>
    <span class="o">}</span>, 
    <span class="s2">"_id"</span>: <span class="s2">"admin"</span>, 
    <span class="s2">"_links"</span>: <span class="o">{</span>
        <span class="s2">"curies"</span>: <span class="o">[]</span>, 
        <span class="s2">"self"</span>: <span class="o">{</span>
            <span class="s2">"href"</span>: <span class="s2">"/auth/users/admin"</span>
        <span class="o">}</span>
    <span class="o">}</span>, 
    <span class="s2">"password"</span>: <span class="s2">"12345"</span>, 
    <span class="s2">"roles"</span>: <span class="o">[</span>
        <span class="s2">"ADMIN"</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <h3 id="create-another-user">10. Create another user</h3>

  <p>Now RESTHeart is ready to be fully managed by the <code class="language-plaintext highlighter-rouge">admin</code> user. For
example, to add more users for the DbIdentityManager it’s enough to use
the following API call.</p>

  <p>Let’s create a new user with id “johnsmith”, password ”Qer432” and role
“USER”</p>

  <pre><code class="language-plain">$ http -a admin:12345 -j POST 192.168.99.100/auth/users _id="johnsmith" password="Qer432" roles:='["USER"]'

HTTP/1.1 201 Created
...
</code></pre>

  <h3 id="check-the-new-user">11. Check the new user</h3>

  <p>Get the <code class="language-plaintext highlighter-rouge">/auth/users/johnsmith</code> resource</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>http <span class="nt">-a</span> admin:temp 192.168.99.100/auth/users/johnsmith

HTTP/1.1 200 OK
Access-Control-Allow-Credentials: <span class="nb">true
</span>Access-Control-Allow-Origin: <span class="k">*</span>
Access-Control-Expose-Headers: Location, ETag, Auth-Token, Auth-Token-Valid-Until, Auth-Token-Location, X-Powered-By
Auth-Token: df20de0a-f9ba-40dc-a659-86031f501509
Auth-Token-Location: /_authtokens/admin
Auth-Token-Valid-Until: 2016-01-07T18:32:43.687Z
Connection: keep-alive
Content-Encoding: <span class="nb">gzip
</span>Content-Length: 160
Content-Type: application/hal+json
Date: Thu, 07 Jan 2016 18:17:43 GMT
ETag: 568eab70c9e77c000646e831
X-Powered-By: restheart.org
<span class="o">{</span>
    <span class="s2">"_etag"</span>: <span class="o">{</span>
        <span class="s2">"</span><span class="nv">$oid</span><span class="s2">"</span>: <span class="s2">"568eab70c9e77c000646e831"</span>
    <span class="o">}</span>, 
    <span class="s2">"_id"</span>: <span class="s2">"johnsmith"</span>, 
    <span class="s2">"_links"</span>: <span class="o">{</span>
        <span class="s2">"curies"</span>: <span class="o">[]</span>, 
        <span class="s2">"self"</span>: <span class="o">{</span>
            <span class="s2">"href"</span>: <span class="s2">"/auth/users/johnsmith"</span>
        <span class="o">}</span>
    <span class="o">}</span>, 
    <span class="s2">"password"</span>: <span class="s2">"Qer432"</span>, 
    <span class="s2">"roles"</span>: <span class="o">[</span>
        <span class="s2">"USER"</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>  </div>

</div>

    </div>
</div>
    </div>

    <footer class="bs-docs-footer mt-0">
  <!-- <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script> -->
  <div id="fb-root"></div>
  <section id="mainFooter">
    <div class="container-fluid">
      <div>
        <div class="bs-docs-social">
          <ul class="socialNetwork">
            <li class="ml-auto">
              <a href="https://twitter.com/softinstigate" class="tips" title="Follow us on Twitter" data-original-title="follow us on Twitter"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#twitter" /></svg>
              </a>
            </li>
            <li>
              <a href="https://github.com/softinstigate/restheart" class="tips" title="Get the source code" data-original-title="get the source code"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#github" /></svg>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div>
        Made with
        <!--<span class="glyphicon glyphicon-heart"></span>-->
        <svg class="footer__like"><use xlink:href="/images/sprite.svg#like" /></svg>
        by
        <a href="https://www.softinstigate.com" target="_blank">SoftInstigate</a>
      </div>
      <div>
        <a href="https://softinstigate.com/en/privacy" class="mr-2 small">Privacy Policy</a>
        <a href="https://www.iubenda.com/privacy-policy/15571002/cookie-policy" class="small iubenda-nostyle no-brand iubenda-embed " title="Cookie Policy">Cookie Policy</a>
      </div>
    </section>
</footer>

    <!-- End Document ================================================== -->
</body>

</html>
<!-- add copy button on code snippet -->
<script src="/assets/js/clipboard.min.js"></script>
<style>
    .listingblock:hover .clipboard {
        display: block;
    }

    .clipboard {
        display: none;
        border: 0;
        font-size: .75em;
        text-transform: uppercase;
        font-weight: 800;
        padding: 2px;
        color: #999;
        position: absolute;
        top: 6px;
        right: 10px;
        background: transparent;
    }

    code + .clipboard {
        padding: 0;
    }

    .clipboard:hover, .clipboard:focus, .clipboard:active {
        outline: 0;
        color: white;
        /* background-color: #eee9e6; */
    }
</style>
<!-- add copy button on code snippet -->
<script>
    window.onload = function() {
        function target(b) {
            var p = b.parentNode;
            if (p.className.includes("highlight")) {
                var elems = p.getElementsByTagName("code");
                if (elems.length > 0) {
                    return elems[0];
                }
            }
            return p.childNodes[0];
        }

        var pre = document.getElementsByTagName('pre');
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copy';
            // b.innerHTML = '<i style="font-size:18px" class="icon-clipboard"></i>';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }

        var clipboard = new ClipboardJS('.clipboard', {
            // this custom text function, remove any line that doesn't start with $
            text: function (trigger) {
                var t = target(trigger);
                const text = target(trigger).outerText;

                if (text) {
                    const dataLang = t.getAttribute('data-lang');
                    if (dataLang === 'bash') {
                        return text
                            .replace(/^(?!\$.*$).*/gm, '') // remove lines that don't start with $
                            .replace(/^\$ */gm, '') // remove leading $
                            .replace(/^\s*[\r\n]/gm, '') // remove blank lines
                            .replace(/^\s+|\s+$/gm, ''); // trim string
                    }
                }
            },
            target: target
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copied';
            setTimeout(function() {
                e.trigger.textContent = 'Copy';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>