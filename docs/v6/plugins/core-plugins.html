<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->

<html lang="en">
<!--<![endif]-->
<head>
   <meta charset="utf-8">
   <title>RESTHeart - Develop Core Plugins</title>
   <meta name="description" content="Low code API Framework for MongoDB">
   <meta name="author" content="SoftInstigate srl">
   <meta name="keywords" content="restheart,mongodb,rest,,graphql,api,http,microservice,java,framework">
   <!-- Open Graph -->
   <meta property="og:type" content="website">
   <meta property="og:url" content="https://restheart.org">
   <meta property="og:logo" content="/images/restheart logo.svg">
   <meta property="og:title" content="RESTHeart - Develop Core Plugins">
   <meta property="og:description" content="Low code API Framework for MongoDB">
   <meta property="og:locale" content="en">
   
   <!-- avoid search engine indexing of old documentation pages  -->
   <meta name="robots" content="noindex,nofollow">
   
   <!-- Mobile Specific Metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <!-- icon fonts -->
   <script src="/js/fontawesome.com_c39cf060d4.js"></script>
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons.css">
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons-ie7.css">
   <!-- Custom css -->
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <!-- js ================================================== -->
   <script src="https://code.jquery.com/jquery.min.js"></script>
   <script src="/assets/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
   <script src="https://unpkg.com/@stackblitz/sdk/bundles/sdk.umd.js"></script>
   <script src="/js/carousel.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>
   <!-- Github buttons. -->
   <script async defer src="https://buttons.github.io/buttons.js"></script>
   <!--iframeResizer-->
  <script src="/assets/js/iframe-resizer.parent.js"></script>
   <!-- Favicons ================================================== -->
  <link rel="icon" type="image/svg+xml" href="/images/restheart logo.svg" />
  <link rel="shortcut icon" href="/images/favicon/favicon.png" />
  <link rel="canonical" href="https://restheart.org/docs/v6/plugins/core-plugins">
  <link rel="alternate" type="application/atom+xml" title="RESTHeart - API Framework" href="https://restheart.org/feed.xml" />
  <script defer data-domain="restheart.org" src="https://plausible.io/js/script.js"></script>
</head>


<body>
    <header id="mainHeader" class="fixed-top background-primary" role="banner">
    <div class="container-fluid">
        <nav class="navbar navbar-default scrollMenu navbar-expand-lg" role="navigation">
            <a class="navbar-brand" href="/">
                <h2 class="text-white"><strong>REST</strong>Heart</h2>
            </a>
            <!-- Place this tag where you want the button to render. -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span
                    class="sr-only">Toggle navigation</span> &#x2630;</button>
            <div class="collapse navbar-collapse navbar-ex1-collapse background-primary" id="scrollTarget">
                <ul class="nav navbar-nav ml-md-auto">
                    <!-- only bounce slack button on home page-->
                    
                    

                    <li class="nav-item ml-1 ml-lg-2 ml-xl-4 mb-0 pb-0 ">
                        <a class="github-button" href="https://github.com/SoftInstigate/restheart" data-size="large" data-show-count="true" aria-label="Star SoftInstigate/restheart on GitHub"></a>
                    </li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/sophia">Ask Sophia</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs">Docs</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/faq">FAQ</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/setup-with-docker/">GET</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/contact">Contacts</a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>

<div class="alert alert-warning m-0 text-center" role="alert">
    <strong>RESTHeart 8 is the current stable release. Switch documentation to <a href="/docs">v8</a></strong>
</div>



<a  target="_blank" class="gitter-open-chat-button fixed-bottom-right" href="https://join.slack.com/t/restheart/shared_invite/zt-1olrhtoq8-5DdYLBWYDonFGEALhmgSXQ"></a>


    <div class="page-content">
        <div class="container-fluid imgHover doc">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <div class="bd-sidebar__head">
                <div class="dropdown d-flex justify-content-center w-100">
                    <button class="btn btn-secondary dropdown-toggle w-100 p-1 mb-2" type="button"
                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        v6
                    </button>
                    <div class="dropdown-menu mt-2 mr-1 pb-2" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="/docs">
                            
                            v8
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v7">
                            
                            v7
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v6">
                            
                            <strong>v6</strong>
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v5">
                            
                            v5
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v4">
                            
                            v4
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v3">
                            
                            v3
                            
                        </a>
                    </div>
                </div>
                <form action="https://www.google.com/search" class="form bd-sidebar__search d-flex" method="get"
                    name="searchform" target="_blank">
                    <input name="sitesearch" type="hidden" value="restheart.org/docs">
                    <input autocomplete="on" class="form-control input-sm search bd-sidebar__input" name="q"
                        placeholder="Search" required="required" type="text">
                    <button class="bd-sidebar__submit" type="submit">
                        <svg width="16" height="16">
                            <use xlink:href="/images/sprite.svg#search" /></svg>
                    </button>
                </form>
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <a href="https://github.com/SoftInstigate/restheart-website/edit/master/docs/v6/plugins/core-plugins.md"
                        class="small mt-2 mb-1 ml-lg-auto"><i class="icon-pencil"></i>Edit Page</a>
                    <button class="btn btn-link bd-sidebar__toggle navbar-expand-md p-0 mb-1 d-md-none" type="button"
                        data-toggle="collapse" data-target="#bd-sidebar__menu" aria-controls="bd-sidebar__menu"
                        aria-expanded="false" aria-label="Toggle docs navigation">
                        Table of Contents
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30"
                            focusable="false">
                            <title>Menu</title>
                            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10"
                                d="M4 7h22M4 15h22M4 23h22" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="bd-sidebar__menu collapse d-md-block" id="bd-sidebar__menu">
                
                    <h2 id="get-started">Get Started</h2>
<ul>
    <li><a href="/docs/v6">Overview</a></li>
    <li><a href="/docs/v6/try">Try RESTHeart online</a></li>
    <li><a href="/docs/v6/ng-demo">A simple Angular demo</a></li>
    <li><a href="/docs/v6/tutorial">Data API Tutorial</a></li>
    <li><a href="/docs/v6/performances">Performances</a></li>
    <li><a href="/docs/v6/blog-posts">Blog posts</a></li>
    <li><a href="/docs/v6/video-tutorials">Video Tutorials</a></li>
    <li><a href="/docs/v6/upgrade-to-v6">Upgrade to v6</a></li>
    <li><a href="https://github.com/SoftInstigate/restheart/discussions/425">Roadmap for v7</a></li>
</ul>


<h2 id="get-started" class="mt-2">Installation and Configuration</h2>
<ul>
    <li><a href="/docs/v6/setup"><strong>Setup</strong></a></li>
    <li><a href="/docs/v6/setup-with-docker">Setup with Docker</a></li>
    <li><a href="/docs/v6/configuration">Configuration</a></li>
    <li><a href="/docs/v6/security/tls">Configure TLS</a></li>
    <li><a href="/docs/v6/security/security-hardening">Security Hardening</a></li>
    <li><a href="/docs/v6/clustering">Clustering &amp; Load Balancing</a></li>
    <li><a href="/docs/v6/enterprise-license">Enterprise License</a></li>
</ul>

<h2 id="core" class="mt-2">Core Framework</h2>
<ul>
    <li><a href="/docs/v6/plugins/overview">Overview</a></li>
    <li><a href="/docs/v6/plugins/dev-env">Development Environment Setup</a></li>
    <li><a href="/docs/v6/plugins/deploy">How to deploy Plugins</a></li>
    <li><a href="/docs/v6/plugins/core-plugins">Core Plugins</a></li>
    <li><a href="/docs/v6/plugins/core-plugins-js">Core Plugins in JavaScript</a></li>
    <li><a href="/docs/v6/plugins/security-plugins">Security Plugins</a></li>
    <li><a href="/docs/v6/graalvm"><strong>GraalVM</strong></a></li>
    <li><a href="/docs/v6/proxy">Proxying requests</a></li>
    <li><a href="/docs/v6/static-resources">Serving static resources</a></li>
    <li><a href="/docs/v6/cors-support">CORS Support</a></li>
    <li><a href="/docs/v6/logging">Logging</a></li>
    <li><a href="/docs/v6/auditing">Auditing</a></li>
</ul>

<h2 id="security" class="mt-2">Authentication and Authorization</h2>
<ul>
    <li><a href="/docs/v6/security/overview">Overview</a></li>
    <li><a href="/docs/v6/security/authentication">Authentication</a></li>
    <li><a href="/docs/v6/security/authorization">Authorization</a></li>
    <li><a href="/docs/v6/security/user-management">User Management</a></li>
    <li><a href="/docs/v6/security/how-clients-authenticate">How Clients Authenticate</a></li>
</ul>

<h2 id="data-api" class="mt-2">Data API on MongoDB</h2>
<h3>REST API</h3>
<ul>
    <li><a href="/docs/v6/mongodb-rest/resource-uri">Resource URIs</a></li>
    <li><a href="/docs/v6/mongodb-rest/representation-format">Representation Format</a></li>
    <li><a href="/docs/v6/mongodb-rest/sample-data">Load Sample Data into MongoDB</a></li>
    <li><a href="/docs/v6/mongodb-rest/read-docs">Read JSON Documents</a></li>
    <li><a href="/docs/v6/mongodb-rest/write-docs">Write JSON Documents</a></li>
    <li><a href="/docs/v6/mongodb-rest/files">Binary Files with GridFS</a></li>
    <li><a href="/docs/v6/mongodb-rest/secure-connection-to-mongodb">Secure connection to MongoDB</a></li>
    <li><a href="/docs/v6/mongodb-rest/aggregations">Aggregations</a></li>
    <li><a href="/docs/v6/mongodb-rest/dbs-collections">Manage Dbs and Collections</a></li>
    <li><a href="/docs/v6/mongodb-rest/indexes">Indexes</a></li>
    <li><a href="/docs/v6/mongodb-rest/relationships">Relationships</a></li>
    <li><a href="/docs/v6/mongodb-rest/csv">Upload CSV files</a></li>
    <li><a href="/docs/v6/mongodb-rest/json-schema-validation">JSON Schema Validation</a></li>
    <li><a href="/docs/v6/mongodb-rest/transactions">Transactions</a></li>
    <li><a href="/docs/v6/mongodb-rest/etag">ETag</a></li>
    <li><a href="/docs/v6/mongodb-rest/speedup-requests-with-cursor-pools">Cursor Pools</a></li>
    <li><a href="/docs/v6/mongodb-rest/shard-keys">Shard Keys</a></li>
    <li><a href="/docs/v6/mongodb-rest/monitoring">Monitoring</a></li>
</ul>

<h3 id="graphql">GraphQL API</h3>
<ul>
    <li><a href="/docs/v6/mongodb-graphql/">GraphQL Applications</a></li>
    <li><a href="/docs/v6/mongodb-graphql/optimization">Optimization</a></li>
    <li><a href="/docs/v6/mongodb-graphql/example">Example</a></li>
</ul>

<h3 id="websocket">Websocket API</h3>
<ul>
    <li><a href="/docs/v6/mongodb-websocket/">Websocket API</a></li>
    <li><a href="/docs/v6/mongodb-websocket/change-streams">Streams definition</a></li>
    <li><a href="/docs/v6/mongodb-websocket/variables">Variables</a></li>
    <li><a href="/docs/v6/mongodb-websocket/examples">Examples</a></li>
</ul>
                
            </div>
        </div>
        <div class="d-none d-xl-block col-xl-2 order-last bd-toc">

  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#Dependency">Dependency</a></li>
        <li><a href="#@register-plugin-annotation">@RegisterPlugin annotation</a></li>
        <li><a href="#plugin-configuration">Plugin Configuration</a></li>
        <li><a href="#dependency-injection">Dependency injection</a></li>
        <li><a href="#request-and-response-generic-classes">Request and Response Generic Classes</a></li>
      </ul>
    </li>
    <li><a href="#services">Services</a></li>
    <li><a href="#interceptors">Interceptors</a></li>
    <li><a href="#initializers">Initializers</a></li>
  </ul>

</div>
<div class="col-12 col-md-9 col-xl-8 py-md-3 bd-content">

  <div class="docs-head d-flex align-items-center justify-content-between">
    <h2 class="d-flex align-items-center m-0 pr-3">
        <span>Develop Core Plugins</span>
    </h2>
</div>

  <div class="alert alert-warning" role="alert">
    <h2 class="alert-heading">
            <svg class="float-left mr-3 my-auto d-block" width="30px" height="30px">
                    <use xlink:href="/images/sprite.svg#feather" />
                </svg>
        This page is being updated.
    </h2>
    <hr class="mt-2 mb-2" />
    <p><strong>REST</strong>Heart v6 introduces many news features, improvements and changes.</p>
    <p>As a consequence, this page will be updated soon.</p>
    <p>Read <a href="/docs/upgrade-to-v6" class="alert-link">Upgrade to v6</a> for a one-page description of the changes.
    </p>
</div>

  <h2 id="services">Services</h2>

  <p>Depending on the content type, the Service class implements one of the specialized <code class="language-plaintext highlighter-rouge">org.restheart.plugins.Service</code> interfaces. The following implementation are provided by <code class="language-plaintext highlighter-rouge">restheart-commons</code>:</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">ByteArrayService</code></li>
    <li><code class="language-plaintext highlighter-rouge">JsonService</code></li>
    <li><code class="language-plaintext highlighter-rouge">BsonService</code></li>
  </ul>

  <p>The code of example <a href="https://github.com/SoftInstigate/restheart/tree/master/examples/mongo-status-service">mongo-status-service</a> implementing <code class="language-plaintext highlighter-rouge">BsonService</code> and using the <code class="language-plaintext highlighter-rouge">MongoClient</code> obtained via <code class="language-plaintext highlighter-rouge">@InjectMongoClient</code> follows:</p>

  <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RegisterPlugin</span><span class="o">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">"serverstatus"</span><span class="o">,</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s">"returns MongoDB serverStatus"</span><span class="o">,</span>
        <span class="n">enabledByDefault</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
        <span class="n">defaultURI</span> <span class="o">=</span> <span class="s">"/status"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MongoServerStatusService</span> <span class="kd">implements</span> <span class="nc">BsonService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="no">LOGGER</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">MongoServerStatusService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="nc">MongoClient</span> <span class="n">mongoClient</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BsonDocument</span> <span class="no">COMMAND</span> <span class="o">=</span> <span class="n">document</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"serverStatus"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

    <span class="nd">@InjectMongoClient</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">MongoClient</span> <span class="n">mongoClient</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mongoClient</span> <span class="o">=</span> <span class="n">mongoClient</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="nc">BsonRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">BsonResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">isGet</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">var</span> <span class="n">serverStatus</span> <span class="o">=</span> <span class="n">mongoClient</span><span class="o">.</span><span class="na">getDatabase</span><span class="o">(</span><span class="s">"admin"</span><span class="o">).</span><span class="na">runCommand</span><span class="o">(</span><span class="no">COMMAND</span><span class="o">,</span> <span class="nc">BsonDocument</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

            <span class="n">response</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">serverStatus</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">SC_OK</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentTypeAsJson</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// Any other HTTP verb is a bad request</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">SC_BAD_REQUEST</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <p>The key method is <code class="language-plaintext highlighter-rouge">handle()</code> that is executed when a request to the service URI hits RESTHeart.</p>

  <h3 id="create-service-with-custom-generic-type">Create Service with custom generic type</h3>

  <p>To implement a Service that handles different types of Request and Response, it must implement the base <code class="language-plaintext highlighter-rouge">Service</code> interface.</p>

  <p>The base <code class="language-plaintext highlighter-rouge">Service</code> interface requires to implement methods to initialize and retrieve the Request and Response objects.</p>

  <p>The following example shows how to handle XML content:</p>

  <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"myXmlService"</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"example service consuming XML requests"</span><span class="o">,</span>
    <span class="n">enabledByDefault</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
    <span class="n">defaultURI</span> <span class="o">=</span> <span class="s">"/xml"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyXmlService</span> <span class="kd">implements</span> <span class="nc">Service</span><span class="o">&lt;</span><span class="nc">XmlRequest</span><span class="o">,</span> <span class="nc">XmlResponse</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">&gt;</span> <span class="nf">requestInitializer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlRequest</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">&gt;</span> <span class="nf">responseInitializer</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlResponse</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">,</span> <span class="nc">JsonRequest</span><span class="o">&gt;</span> <span class="nf">request</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="k">default</span> <span class="nc">Function</span><span class="o">&lt;</span><span class="nc">HttpServerExchange</span><span class="o">,</span> <span class="nc">JsonResponse</span><span class="o">&gt;</span> <span class="nf">response</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="nc">XmlResponse</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <p>The example follows a pattern that delegates the actual initialization (in <code class="language-plaintext highlighter-rouge">requestInitializer()</code> and <code class="language-plaintext highlighter-rouge">responseInitializer()</code>) and retrieval of the object from the exchange (in <code class="language-plaintext highlighter-rouge">request()</code> and <code class="language-plaintext highlighter-rouge">response()</code>) to the concrete class, as follows:</p>

  <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlRequest</span> <span class="kd">extends</span> <span class="nc">ServiceRequest</span><span class="o">&lt;</span><span class="nc">Document</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nf">XmlRequest</span><span class="o">(</span><span class="nc">HttpServerExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">XmlRequest</span> <span class="nf">init</span><span class="o">(</span><span class="nc">HttpServerExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">ret</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XmlRequest</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">ret</span><span class="o">.</span><span class="na">injectContent</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">ieo</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ret</span><span class="o">.</span><span class="na">setInError</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">XmlRequest</span> <span class="nf">of</span><span class="o">(</span><span class="nc">HttpServerExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">of</span><span class="o">(</span><span class="n">exchange</span><span class="o">,</span> <span class="nc">XmlRequest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">injectContent</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">SAXException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">dBuilder</span> <span class="o">=</span> <span class="nc">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
        <span class="kt">var</span> <span class="n">rawContent</span> <span class="o">=</span> <span class="nc">ChannelReader</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">wrapped</span><span class="o">.</span><span class="na">getRequestChannel</span><span class="o">());</span>

        <span class="n">setContent</span><span class="o">(</span><span class="n">xdBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">rawContent</span><span class="o">)</span><span class="n">ml</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <p>In the constructor a call to <code class="language-plaintext highlighter-rouge">super(exchange)</code> attaches the object to the <code class="language-plaintext highlighter-rouge">HttpServerExchange</code>. The object is retrieved using the inherited <code class="language-plaintext highlighter-rouge">of()</code> method that gets the instance attachment from the <code class="language-plaintext highlighter-rouge">HttpServerExchange</code>. This is fundamental for two reasons: first the same request and response objects must be shared by the all handlers of the processing chain. Second, this avoid the need to parse the content several times for performance reasons.</p>

  <p class="bs-callout bs-callout-info">Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=680s">Services</a></p>

  <h2 id="interceptors">Interceptors</h2>

  <p>Interceptors allow to snoop and modify requests and responses at different
 stages of the request lifecycle as defined by the interceptPoint parameter of
 the annotation <code class="language-plaintext highlighter-rouge">@RegisterPlugin</code>.</p>

  <p>An interceptor can intercept either proxied requests or requests handled by
 Services.</p>

  <p>An interceptor can intercept requests handled by a Service when its request
 and response types are equal to the ones declared by the Service.</p>

  <p>An interceptor can intercept a proxied request, when its request and response
 types extends BufferedRequest and BufferedResponse.</p>

  <p>The following implementation are provided by <code class="language-plaintext highlighter-rouge">restheart-commons</code>:</p>

  <ul>
    <li><code class="language-plaintext highlighter-rouge">ByteArrayInterceptor</code> intercepts requests handled by services implementing <code class="language-plaintext highlighter-rouge">ByteArrayService</code></li>
    <li><code class="language-plaintext highlighter-rouge">JsonInterceptor</code> intercepts requests handled by services implementing <code class="language-plaintext highlighter-rouge">JsonService</code></li>
    <li><code class="language-plaintext highlighter-rouge">BsonInterceptor</code> intercepts requests handled by services implementing <code class="language-plaintext highlighter-rouge">BsonService</code></li>
    <li><code class="language-plaintext highlighter-rouge">MongoInterceptor</code> intercepts requests handled by the MongoService</li>
  </ul>

  <p>The last one is particularly useful as it allows intercepting requests to the MongoDb API.</p>

  <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"secretFilter"</span><span class="o">,</span>
    <span class="n">interceptPoint</span> <span class="o">=</span> <span class="nc">InterceptPoint</span><span class="o">.</span><span class="na">RESPONSE</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"removes the property 'secret' from GET /coll"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReadOnlyPropFilter</span> <span class="kd">implements</span> <span class="nc">MongoInterceptor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="nc">MongoRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">MongoResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">isDocument</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">asDocument</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="s">"secret"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">isArray</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">asArray</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">doc</span> <span class="o">-&gt;</span> <span class="n">doc</span><span class="o">.</span><span class="na">asDocument</span><span class="o">())</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">doc</span> <span class="o">-&gt;</span> <span class="n">doc</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"secret"</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">resolve</span><span class="o">(</span><span class="nc">MongoRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">MongoResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">isGet</span><span class="o">()</span>
            <span class="o">&amp;&amp;</span> <span class="n">response</span><span class="o">.</span><span class="na">getContent</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span>
            <span class="o">&amp;&amp;</span> <span class="s">"coll"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getCollectionName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div>  </div>

  <p>The <code class="language-plaintext highlighter-rouge">handle()</code> method is invoked only if the <code class="language-plaintext highlighter-rouge">resolve()</code> method returns true.</p>

  <p class="bs-callout bs-callout-info">Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=986s">Interceptors</a></p>

  <h2 id="initializers">Initializers</h2>

  <p>An <em>Initializer</em> allows executing custom logic at startup time.</p>

  <p>The Initializer implementation class must extend the <code class="language-plaintext highlighter-rouge">org.restheart.plugins.Initializer</code> interface:</p>

  <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Initializer</span> <span class="kd">extends</span> <span class="nc">ConfigurablePlugin</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <p>With the following code the Initializer hangs restheart startup until the user confirms.</p>

  <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RegisterPlugin</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"confirmStartupInitializer"</span><span class="o">,</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s">"hangs restheart startup until the user hits &lt;enter&gt;"</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span>
    <span class="n">initPoint</span> <span class="o">=</span> <span class="nc">InitPoint</span><span class="o">.</span><span class="na">BEFORE_STARTUP</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">confirmStartupInitializer</span> <span class="kd">implements</span> <span class="nc">Initializer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hit &lt;enter&gt; to start RESTHeart"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">console</span><span class="o">().</span><span class="na">readLine</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>  </div>

  <p class="bs-callout bs-callout-info">Watch <a href="https://www.youtube.com/watch?v=GReteuiMUio&amp;t=1274s">Initializers</a></p>

  <hr />

</div>

    </div>
</div>
    </div>

    <footer class="bs-docs-footer mt-0">
  <!-- <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script> -->
  <div id="fb-root"></div>
  <section id="mainFooter">
    <div class="container-fluid">
      <div>
        <div class="bs-docs-social">
          <ul class="socialNetwork">
            <li class="ml-auto">
              <a href="https://twitter.com/softinstigate" class="tips" title="Follow us on Twitter" data-original-title="follow us on Twitter"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#twitter" /></svg>
              </a>
            </li>
            <li>
              <a href="https://github.com/softinstigate/restheart" class="tips" title="Get the source code" data-original-title="get the source code"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#github" /></svg>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div>
        Made with
        <!--<span class="glyphicon glyphicon-heart"></span>-->
        <svg class="footer__like"><use xlink:href="/images/sprite.svg#like" /></svg>
        by
        <a href="https://www.softinstigate.com" target="_blank">SoftInstigate</a>
      </div>
      <div>
        <a href="https://softinstigate.com/en/privacy" class="mr-2 small">Privacy Policy</a>
        <a href="https://www.iubenda.com/privacy-policy/15571002/cookie-policy" class="small iubenda-nostyle no-brand iubenda-embed " title="Cookie Policy">Cookie Policy</a>
      </div>
    </section>
</footer>

    <!-- End Document ================================================== -->
</body>

</html>
<!-- add copy button on code snippet -->
<script src="/assets/js/clipboard.min.js"></script>
<style>
    .listingblock:hover .clipboard {
        display: block;
    }

    .clipboard {
        display: none;
        border: 0;
        font-size: .75em;
        text-transform: uppercase;
        font-weight: 800;
        padding: 2px;
        color: #999;
        position: absolute;
        top: 6px;
        right: 10px;
        background: transparent;
    }

    code + .clipboard {
        padding: 0;
    }

    .clipboard:hover, .clipboard:focus, .clipboard:active {
        outline: 0;
        color: white;
        /* background-color: #eee9e6; */
    }
</style>
<!-- add copy button on code snippet -->
<script>
    window.onload = function() {
        function target(b) {
            var p = b.parentNode;
            if (p.className.includes("highlight")) {
                var elems = p.getElementsByTagName("code");
                if (elems.length > 0) {
                    return elems[0];
                }
            }
            return p.childNodes[0];
        }

        var pre = document.getElementsByTagName('pre');
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copy';
            // b.innerHTML = '<i style="font-size:18px" class="icon-clipboard"></i>';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }

        var clipboard = new ClipboardJS('.clipboard', {
            // this custom text function, remove any line that doesn't start with $
            text: function (trigger) {
                var t = target(trigger);
                const text = target(trigger).outerText;

                if (text) {
                    const dataLang = t.getAttribute('data-lang');
                    if (dataLang === 'bash') {
                        return text
                            .replace(/^(?!\$.*$).*/gm, '') // remove lines that don't start with $
                            .replace(/^\$ */gm, '') // remove leading $
                            .replace(/^\s*[\r\n]/gm, '') // remove blank lines
                            .replace(/^\s+|\s+$/gm, ''); // trim string
                    }
                }
            },
            target: target
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copied';
            setTimeout(function() {
                e.trigger.textContent = 'Copy';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>