<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->

<html lang="en">
<!--<![endif]-->
<head>
   <meta charset="utf-8">
   <title>RESTHeart - Authentication</title>
   <meta name="description" content="Low code API Framework for MongoDB">
   <meta name="author" content="SoftInstigate srl">
   <meta name="keywords" content="restheart,mongodb,rest,,graphql,api,http,microservice,java,framework">
   <!-- Open Graph -->
   <meta property="og:type" content="website">
   <meta property="og:url" content="https://restheart.org">
   <meta property="og:logo" content="/images/restheart logo.svg">
   <meta property="og:title" content="RESTHeart - Authentication">
   <meta property="og:description" content="Low code API Framework for MongoDB">
   <meta property="og:locale" content="en">
   
   <!-- Mobile Specific Metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <!-- icon fonts -->
   <script src="/js/fontawesome.com_c39cf060d4.js"></script>
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons.css">
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons-ie7.css">
   <!-- Custom css -->
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <!-- js ================================================== -->
   <script src="https://code.jquery.com/jquery.min.js"></script>
   <script src="/assets/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
   <script src="https://unpkg.com/@stackblitz/sdk/bundles/sdk.umd.js"></script>
   <script src="/js/carousel.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>
   <!-- Github buttons. -->
   <script async defer src="https://buttons.github.io/buttons.js"></script>
   <!--iframeResizer-->
  <script src="/assets/js/iframe-resizer.parent.js"></script>
   <!-- Favicons ================================================== -->
  <link rel="icon" type="image/svg+xml" href="/images/restheart logo.svg" />
  <link rel="shortcut icon" href="/images/favicon/favicon.png" />
  <link rel="canonical" href="https://restheart.org/docs/security/authentication">
  <link rel="alternate" type="application/atom+xml" title="RESTHeart - API Framework" href="https://restheart.org/feed.xml" />
  <script defer data-domain="restheart.org" src="https://plausible.io/js/script.js"></script>
</head>


<body>
    <header id="mainHeader" class="fixed-top background-primary" role="banner">
    <div class="container-fluid">
        <nav class="navbar navbar-default scrollMenu navbar-expand-lg" role="navigation">
            <a class="navbar-brand" href="/">
                <h2 class="text-white"><strong>REST</strong>Heart</h2>
            </a>
            <!-- Place this tag where you want the button to render. -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span
                    class="sr-only">Toggle navigation</span> &#x2630;</button>
            <div class="collapse navbar-collapse navbar-ex1-collapse background-primary" id="scrollTarget">
                <ul class="nav navbar-nav ml-md-auto">
                    <!-- only bounce slack button on home page-->
                    
                    

                    <li class="nav-item ml-1 ml-lg-2 ml-xl-4 mb-0 pb-0 ">
                        <a class="github-button" href="https://github.com/SoftInstigate/restheart" data-size="large" data-show-count="true" aria-label="Star SoftInstigate/restheart on GitHub"></a>
                    </li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/sophia">Ask Sophia</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs">Docs</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/faq">FAQ</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/setup-with-docker/">GET</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/contact">Contacts</a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>



<a  target="_blank" class="gitter-open-chat-button fixed-bottom-right" href="https://join.slack.com/t/restheart/shared_invite/zt-1olrhtoq8-5DdYLBWYDonFGEALhmgSXQ"></a>


    <div class="page-content">
        <div class="container-fluid imgHover doc">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <div class="bd-sidebar__head">
                <div class="dropdown d-flex justify-content-center w-100">
                    <button class="btn btn-secondary dropdown-toggle w-100 p-1 mb-2" type="button"
                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        v8
                    </button>
                    <div class="dropdown-menu mt-2 mr-1 pb-2" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="/docs">
                            
                            <strong>v8</strong>
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v7">
                            
                            v7
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v6">
                            
                            v6
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v5">
                            
                            v5
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v4">
                            
                            v4
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v3">
                            
                            v3
                            
                        </a>
                    </div>
                </div>
                <form action="https://www.google.com/search" class="form bd-sidebar__search d-flex" method="get"
                    name="searchform" target="_blank">
                    <input name="sitesearch" type="hidden" value="restheart.org/docs">
                    <input autocomplete="on" class="form-control input-sm search bd-sidebar__input" name="q"
                        placeholder="Search" required="required" type="text">
                    <button class="bd-sidebar__submit" type="submit">
                        <svg width="16" height="16">
                            <use xlink:href="/images/sprite.svg#search" /></svg>
                    </button>
                </form>
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <a href="https://github.com/SoftInstigate/restheart-website/edit/master/docs/security/authentication.adoc"
                        class="small mt-2 mb-1 ml-lg-auto"><i class="icon-pencil"></i>Edit Page</a>
                    <button class="btn btn-link bd-sidebar__toggle p-0 mb-1 d-md-none" type="button"
                        data-toggle="collapse" data-target="#bd-sidebar__menu" aria-controls="bd-sidebar__menu"
                        aria-expanded="false" aria-label="Toggle docs navigation">
                        Table of Contents
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30"
                            focusable="false">
                            <title>Menu</title>
                            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22" />
                        </svg>
                    </button>
                </div>
            </div>

            <nav class="bd-sidebar__menu collapse d-md-block" id="bd-sidebar__menu">
                
                    
<a data-toggle="collapse" href="#overview" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2>Overview</h2>
</a>
<ul id="overview" class="collapse">
    <li><a href="/docs/upgrade-to-v8"><strong>Upgrade to v8</strong></a></li>
    <li><a href="/docs">Overview</a></li>
    <li><a href="/docs/faq">FAQ</a></li>
    <li><a href="/docs/mongodb-rest/demo-webapp">Demo WebApp with RESTHeart</a></li>
    <li><a href="/docs/performances">Performances</a></li>
    <li><a href="https://github.com/SoftInstigate/restheart/issues?q=is%3Aissue+is%3Aopen+label%3A%22feature+request%22">Roadmap</a></li>
    <li><a href="/docs/plugins/tutorial">Framework Tutorial</a></li>
    <li><a href="/docs/mongodb-rest/tutorial">REST API Tutorial</a></li>
    <li><a href="/docs/mongodb-graphql/tutorial">GraphQL API Tutorial</a></li>
    <li><a href="/docs/security/tutorial">Auth^2 Tutorial</a></li>
    <li><a href="/docs/example-webapps">Example Web Apps built with RESTHeart</a></li>
    <li><a href="/docs/blog-posts">Blog posts</a></li>
    <li><a href="/docs/video-tutorials">Video Tutorials</a></li>
</ul>

<a data-toggle="collapse" href="#setup" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Setup</h2>
</a>
<ul id="setup" class="collapse">
    <li><a href="/docs/setup"><strong>Setup</strong></a></li>
    <li><a href="/docs/setup-with-docker">Setup with Docker</a></li>
    <li><a href="/docs/configuration">Configuration</a></li>
    <li><a href="/docs/default-configuration">Default Configuration</a></li>
    <li><a href="/docs/security/how-clients-authenticate">Client Authentication Howto</a></li>
    <li><a href="/docs/security/user-management">User Management</a></li>
    <li><a href="/docs/graalvm"><strong>GraalVM</strong></a></li>
    <li><a href="/docs/security/security-hardening"><strong>Security Hardening</strong></a></li>
    <li><a href="/docs/security/tls">Configure TLS</a></li>
    <li><a href="/docs/security/secure-connection-to-mongodb">Secure connection to MongoDB</a></li>
    <li><a href="/docs/proxy">Proxying requests</a></li>
    <li><a href="/docs/static-resources">Serving static resources</a></li>
    <li><a href="/docs/logging">Logging</a></li>
    <li><a href="/docs/monitoring">Monitoring</a></li>
    <li><a href="/docs/auditing">Auditing</a></li>
    <li><a href="/docs/clustering">Clustering &amp; Load Balancing</a></li>
    <li><a href="/docs/enterprise-license">Enterprise License</a></li>
</ul>

<a data-toggle="collapse" href="#framework" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Framework</h2>
</a>
<ul id="framework" class="collapse">
    <!-- <li><a href="/docs/plugins/dev-env">Development Environment</a></li> -->
    <li><a href="/docs/plugins/overview">Overview</a></li>
    <li><a href="/docs/plugins/tutorial">Tutorial</a></li>
    <li><a href="/docs/plugins/deploy">How to deploy Plugins</a></li>
    <h3 id="rest-api" class="mt-2">Base Plugins</h2>
    <li><a href="/docs/plugins/services">Services</a></li>
    <li><a href="/docs/plugins/interceptors">Interceptors</a></li>
    <li><a href="/docs/plugins/providers">Providers</a></li>
    <li><a href="/docs/plugins/initializers">Initializers</a></li>
    <li><a href="/docs/plugins/core-plugins-js">Services and Inteceptors in JavaScript</a></li>
    <h3 id="rest-api" class="mt-2">Security Plugins</h2>
    <li><a href="/docs/security/overview">Overview</a></li>
    <li><a href="/docs/plugins/authentication-mechanisms">Authentication Mechanisms</a></li>
    <li><a href="/docs/plugins/authenticators">Authenticators</a></li>
    <li><a href="/docs/plugins/authorizers">Authorizers</a></li>
    <li><a href="/docs/plugins/token-managers">Token Managers</a></li>
</ul>

<a data-toggle="collapse" href="#security" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Security Plugins</h2>
</a>
<ul id="security" class="collapse">
    <li><a href="/docs/security/tutorial">Auth^2 Tutorial</a></li>
    <li><a href="/docs/security/authentication">Authentication</a></li>
    <li><a href="/docs/security/authorization">Authorization</a></li>
    <li><a href="/docs/security/other-security-plugins">Other Security Plugins</a></li>
</ul>

<a  data-toggle="collapse" href="#mongodb" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">MongoDB Plugins</h2>
</a>
<ul id="mongodb" class="collapse">
    <h3 id="rest-api" class="mt-2">REST API</h2>
    <li><a href="/docs/mongodb-rest/tutorial">Getting Started</a></li>
    <li><a href="/docs/mongodb-rest/read-docs">Reading Documents</a></li>
    <li><a href="/docs/mongodb-rest/write-docs">Writing Documents</a></li>
    <li><a href="/docs/mongodb-rest/files">Managing Binary Files</a></li>
    <li><a href="/docs/mongodb-rest/aggregations">Aggregations</a></li>
    <li><a href="/docs/mongodb-rest/dbs-collections">Databases and Collections</a></li>
    <li><a href="/docs/mongodb-rest/indexes">Indexes</a></li>
    <li><a href="/docs/mongodb-rest/csv">CSV Import</a></li>
    <li><a href="/docs/mongodb-rest/transactions">Transactions</a></li>
    <li><a href="/docs/mongodb-rest/caching">Performance and Caching</a></li>
    <li><a href="/docs/mongodb-rest/relationships">Relationships</a></li>
    <li><a href="/docs/mongodb-rest/json-schema-validation">JSON Schema Validation</a></li>
    <li><a href="/docs/mongodb-rest/resource-uri">Resource URIs</a></li>
    <li><a href="/docs/mongodb-rest/representation-format">Representation Format</a></li>
    <li><a href="/docs/mongodb-rest/etag">ETag</a></li>
    <li><a href="/docs/mongodb-rest/shard-keys">Shard Keys</a></li>
    <li><a href="/docs/mongodb-rest/sample-data">Load Sample Data</a></li>

    <h3 id="rest-api" class="mt-2">GraphQL API</h3>
    <li><a href="/docs/mongodb-graphql/">Overview</a></li>
    <li><a href="/docs/mongodb-graphql/getting-started">Getting Started</a></li>
    <li><a href="/docs/mongodb-graphql/graphql-apps">App Definition</a>
        <ul>
            <li><a href="/docs/mongodb-graphql/schema">Schema Design</a></li>
            <li><a href="/docs/mongodb-graphql/mappings">MongoDB Mappings</a></li>
            <li><a href="/docs/mongodb-graphql/resolvers">Custom Resolvers</a></li>
        </ul>
    </li>
    <li><a href="/docs/mongodb-graphql/tutorial">Basic Tutorial</a></li>
    <li><a href="/docs/mongodb-graphql/complex-app-example">Advanced Example</a></li>
    <li><a href="/docs/mongodb-graphql/optimization">Performance Optimization</a></li>
    <li><a href="/docs/mongodb-graphql/best-practices">Best Practices</a></li>

    <h3 id="rest-api" class="mt-2">Websocket API</h3>
    <li><a href="/docs/mongodb-websocket/">Overview</a></li>
    <li><a href="/docs/mongodb-websocket/change-streams">Streams definition</a></li>
    <li><a href="/docs/mongodb-websocket/variables">Variables</a></li>
    <li><a href="/docs/mongodb-websocket/examples">Examples</a></li>
</ul>

<style>
.collapsing {
    -webkit-transition: none;
    transition: none;
    display: none;
}
</style>

<script type="text/javascript">
    // on page load, show the menu element of the current pages
    const menu = 'security';
    if (menu) {
        $(`#${menu}`).collapse('show');
    }
</script>

                
            </nav>
        </div>

        <div class="d-none d-xl-block col-xl-2 order-last bd-toc">
            <ul class="sectlevel2">
<li><a href="#introduction">Introduction</a></li>
<li><a href="#authentication-mechanisms">Authentication Mechanisms</a></li>
<li><a href="#authenticators">Authenticators</a></li>
<li><a href="#token-managers">Token Managers</a></li>
<li><a href="#avoid-browsers-to-open-the-login-popup-window">Avoid browsers to open the login popup window</a></li>
</ul>
        </div>
        <div class="col-12 col-md-9 col-xl-8 py-md-3 bd-content">
            <div class="docs-head d-flex align-items-center justify-content-between">
    <h2 class="d-flex align-items-center m-0 pr-3">
        <span>Authentication</span>
    </h2>
</div>
            <div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>See <a href="/docs/security/overview">Security Overview</a> for an high level view of the RESTHeart security model.</p>
</div>
<div class="paragraph">
<p><strong>RESTHeart</strong> is built around a <strong>pluggable architecture</strong>. It comes with a strong security implementation but you can easily extend it by implementing plugins. This section documents the authentication plugins available out-of-the-box. You can also develop your own authentication plugins.</p>
</div>
</div>
<div class="sect2">
<h3 id="authentication-mechanisms">Authentication Mechanisms</h3>
<div class="sect3">
<h4 id="jwt-authentication">JWT Authentication</h4>
<div class="paragraph">
<p>JWT Authentication manages the authentication following the <a href="https://jwt.io">JSON Web Token standard</a>.</p>
</div>
<div class="paragraph">
<p>The token is verified against the configured <code>issuer</code> and <code>audience</code> and according to the specified <code>algorithm</code>. If you want to disable checking <code>issuer</code> or  <code>audience</code>, set them to <code>null</code>. The property <code>audience</code> can be <code>null</code>, a String or an array of Strings.</p>
</div>
<div class="paragraph">
<p>The authenticated client will gain the roles included in the JWT claim set by <code>rolesClaim</code> or the roles specified by the configuration option <code>fixedRoles</code>. It&#8217;s not possible to set both <code>rolesClaim</code> and <code>fixedRoles</code></p>
</div>
<div class="paragraph">
<p>Supported algorithms are the HMAC256, HMAC384, HMAC512, RSA256, RSA384, RSA512.</p>
</div>
<div class="paragraph">
<p>For HMAC the <code>key</code> configuration option specifies the secret, for RSA the public key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">jwtAuthenticationMechanism</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">algorithm</span><span class="pi">:</span> <span class="s">HS256</span>
    <span class="na">key</span><span class="pi">:</span> <span class="s">secret</span>
    <span class="na">base64Encoded</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">usernameClaim</span><span class="pi">:</span> <span class="s">sub</span>
    <span class="na">rolesClaim</span><span class="pi">:</span> <span class="s">roles</span>
    <span class="na">fixedRoles</span><span class="pi">:</span>
<span class="c1">#      - admin</span>
    <span class="na">issuer</span><span class="pi">:</span> <span class="s">myIssuer</span>
    <span class="na">audience</span><span class="pi">:</span> <span class="s">myAudience</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="basic-authentication">Basic Authentication</h4>
<div class="paragraph">
<p><strong>BasicAuthMechanism</strong> manages the Basic Authentication method, where the client credentials are sent via the <code>Authorization</code> request header using the format <code>Authorization: Basic base64(id:pwd)</code>. The configuration allows specifying the Authenticator that will be used to verify the credentials.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">basicAuthMechanism</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">authenticator</span><span class="pi">:</span> <span class="s">fileRealmAuthenticator</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cookie-authentication">Cookie Authentication</h4>
<div class="paragraph">
<p>Cookie Authentication allows the client browser to store an authentication token in a secure cookie. This mechanism enables authentication based on the stored cookie, allowing the client to remain authenticated across multiple requests without having to send credentials each time. The token is securely saved in the cookie, ensuring that sensitive data is protected and accessible only to the intended server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
this is the suggested authentication mechanism when the client is the browser.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Typically, a client first authenticates using Basic Authentication and then uses the auth token returned in the first response for further requests. This auth token is usually stored in the local storage by web clients. The local storage is readable by JavaScript, thus exposing this approach to Cross-site Scripting (XSS) security attacks. Storing the auth token in a secure cookie avoids XSS.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Using cookie authentication and JWT tokens effectively enables Single Sign-On.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="configuration-options">Configuration Options</h5>
<div class="paragraph">
<p>Cookie Authentication is disabled by default. To enable it, the following three plugins must be enabled and configured: <code>authCookieSetter</code>, <code>authCookieHandler</code>, and <code>authCookieRemover</code>.</p>
</div>
<div class="paragraph">
<p>The cookie authentication mechanism can function using three different options:</p>
</div>
<div class="paragraph">
<p><strong>Option 1: JWT Verified by <code>jwtAuthenticationMechanism</code></strong>
This option is recommended if you also want to allow clients to authenticate via JWTs sent in the <code>Authorization</code> header (not stored in a cookie).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>/tokenBasicAuthMechanism/enabled-&gt;true
/jwtAuthenticationMechanism/enabled-&gt;true
/jwtTokenManager/enabled-&gt;true
/rndTokenManager/enabled-&gt;false</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Option 2: JWT Verified by <code>tokenBasicAuthMechanism</code></strong>
Choose this option if you have multiple instances of RESTHeart verifying cookies, and JWT header-based authentication isn&#8217;t required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>/tokenBasicAuthMechanism/enabled-&gt;true
/jwtAuthenticationMechanism/enabled-&gt;false
/jwtTokenManager/enabled-&gt;true
/rndTokenManager/enabled-&gt;false</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Option 3: RGT Cookies (Randomly Generated Tokens)</strong>
For authentication via RGT cookies, enable these components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>tokenBasicAuthMechanism</code></strong>: Manages the basic authentication process.</p>
</li>
<li>
<p><strong><code>rndTokenManager</code></strong>: Manages and validates randomly generated tokens for Basic Authentication cookies.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>/tokenBasicAuthMechanism/enabled-&gt;true
/jwtAuthenticationMechanism/enabled-&gt;false
/jwtTokenManager/enabled-&gt;false
/rndTokenManager/enabled-&gt;true</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
RGT cookies can only be verified by the RESTHeart instance that issued them. For multi-instance deployments, it is advisable to use JWT cookies instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="authcookiesetter">authCookieSetter</h5>
<div class="paragraph">
<p>This component is responsible for initiating a user&#8217;s authenticated session by setting the authentication cookie.</p>
</div>
<div class="paragraph">
<p>Activates when a URL includes the query parameter <code>?set-auth-cookie</code> and a user is authenticated, setting a cookie populated with a token generated by the enabled Token Manager.</p>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authCookieSetter</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>          <span class="c1"># Not enabled by default</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="no">true</span>            <span class="c1"># true if only allow setting the cookie on https</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rh_auth</span>           <span class="c1"># The name of the cookie to be set</span>
  <span class="na">domain</span><span class="pi">:</span> <span class="s">localhost</span>       <span class="c1"># The domain within which the cookie is valid</span>
  <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>                 <span class="c1"># The cookie path, applicable to the entire domain</span>
  <span class="na">http-only</span><span class="pi">:</span> <span class="no">true</span>         <span class="c1"># If true, enhances security by making the cookie inaccessible to JavaScript</span>
  <span class="na">same-site</span><span class="pi">:</span> <span class="no">true</span>         <span class="c1"># Restricts the cookie to first-party contexts, preventing CSRF attacks</span>
  <span class="na">same-site-mode</span><span class="pi">:</span> <span class="s">strict</span>  <span class="c1"># Strictly prevents the cookie from being sent along with cross-site requests</span>
  <span class="na">expires-ttl</span><span class="pi">:</span> <span class="m">86400</span>     <span class="c1"># Defines the duration (in seconds, default 1 day) for which the cookie is valid</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using JWT tokens, the cookie can be updated by specifying both <code>?set-auth-cookie&amp;renew-auth-token</code>. The query parameter <code>renew-auth-token</code> forces the <code>jwtTokenManager</code> to update the JWT.</p>
</div>
</div>
<div class="sect4">
<h5 id="authcookiehandler">authCookieHandler</h5>
<div class="paragraph">
<p>Responsible for utilizing the authentication cookie to maintain authenticated sessions across requests.</p>
</div>
<div class="paragraph">
<p>Reads the <code>rh_auth</code> cookie (actual cookie name is defined in authCookieSetter configuration), if available, and constructs an Authorization header. This allows for seamless continuation of sessions and supports both Basic and JWT authentication mechanisms.</p>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authCookieHandler</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>          <span class="c1"># Not enabled by default</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="authcookieremover">authCookieRemover</h5>
<div class="paragraph">
<p>Handles the secure and explicit termination of authenticated sessions.</p>
</div>
<div class="paragraph">
<p>Clears the authentication cookie in response to a <code>POST /logout</code> request. This effectively logs out the user by wiping the authentication cookie from the user&#8217;s browser, ensuring the session is securely terminated.</p>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">authCookieRemover</span><span class="pi">:</span>
  <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>          <span class="c1"># Not enabled by default</span>
  <span class="na">secure</span><span class="pi">:</span> <span class="no">false</span>           <span class="c1"># If the request to clean the cookie should be authenticated</span>
  <span class="na">uri</span><span class="pi">:</span> <span class="s">/logout</span>            <span class="c1"># The endpoint that triggers this service</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-usage">Example usage</h5>
<div class="paragraph">
<p>This is an example of how a user might log in, make some requests, and then log out within a system using cookie authentication with the configuration described previously. This example assumes that the system is web-based and communicates over HTTP.</p>
</div>
<div class="sect5">
<h6 id="logging-in">Logging In</h6>
<div class="paragraph">
<p>The user submits their credentials (username and password) via Basic Authentication (<code>Authorization</code> header) from a form on a client application, which sends a GET request to the`/roles/{username}` endpoint, including the <code>?set-auth-cookie</code> query parameters</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">GET</span> <span class="nn">/roles/{username}?set-auth-cookie</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic YWRtaW46c2VjcmV0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the credentials are valid, the server responds by setting an <code>rh_auth</code> cookie containing the authentication token and returns a success response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">rh_auth="Basic YWRtaW46MmliNWFsaDFxajZ4eHY5aWlyOTZsejh1bnJjMHQzNWFucnEyYzh1cG12cHNpOGc3dDQ="; Version=1; Path=/; Domain=localhost; Secure; HttpOnly; Expires=Sat, 20 Apr 2024 11:53:00 GMT; SameSite=Strict</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nl">"authenticated"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"user-role"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the value of the cookie doesn&#8217;t include the actual user credentials but uses the auth token generated by the enabled Token Manager.</p>
</div>
</div>
<div class="sect5">
<h6 id="making-authenticated-requests">Making Authenticated Requests</h6>
<div class="paragraph">
<p>Once the cookie is set, the user can make subsequent requests to the server. The browser automatically includes the <code>rh_auth</code> cookie with each request to the domain.</p>
</div>
<div class="paragraph">
<p>For example, if the user wants to access a protected resource, they might send a GET request to the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">GET</span> <span class="nn">/protected-resource</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">rh_auth="Basic YWRtaW46MmliNWFsaDFxajZ4eHY5aWlyOTZsejh1bnJjMHQzNWFucnEyYzh1cG12cHNpOGc3dDQ="</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The server checks the cookie, validates the session, and if valid, responds with the requested data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Here is your protected resource data."</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="logging-out">Logging Out</h6>
<div class="paragraph">
<p>To log out, the user sends a POST request to the logout endpoint. This request doesn&#8217;t need to include user credentials but should be made from the same domain to ensure the browser includes the authentication cookie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="nf">POST</span> <span class="nn">/logout</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">rh_auth=</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The server processes the logout request and clears the authentication cookie by setting its value to null.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">rh_auth=; path=/; domain=localhost; secure; HttpOnly; SameSite=Strict</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After this, the user is logged out, and their session is terminated. The cookie is invalidated, and any subsequent requests to the server that require authentication will fail until the user logs in again.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="digest-authentication">Digest Authentication</h4>
<div class="paragraph">
<p><strong>DigestAuthMechanism</strong> manages the Digest Authentication method. The configuration allows specifying the Authenticator that will be used to verify the credentials.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">digestAuthMechanism</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">realm</span><span class="pi">:</span> <span class="s">RESTHeart Realm</span>
    <span class="na">domain</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">authenticator</span><span class="pi">:</span> <span class="s">fileRealmAuthenticator</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="token-authentication">Token Authentication</h4>
<div class="paragraph">
<p><strong>TokenBasicAuthMechanism</strong> manages the Basic Authentication method with the actual password replaced by the auth token generated by <strong>RESTHeart</strong>, i.e. the client credentials are sent via the <code>Authorization</code> request header using the format <code>Authorization: Basic base64(id:auth-token)</code>. It requires a Token Manager to be configured (eg. RndTokenManager).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">tokenBasicAuthMechanism</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="identity-authentication">Identity Authentication</h4>
<div class="paragraph">
<p><strong>IdentityAuthMechanism</strong> just authenticates any request building an <a href="https://github.com/SoftInstigate/restheart/blob/master/commons/src/main/java/org/restheart/security/BaseAccount.java">BaseAccount</a> with the <em>username</em> and <em>roles</em> specified in the configuration. Useful for testing purposes. Note that enabling this causes the <em>DigestAuthMechanism</em> to fail, you cannot use both.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">identityAuthMechanism</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">roles</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">admin</span>
    <span class="pi">-</span> <span class="s">user</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=QVk0aboHayM&amp;t=342s">Authentication mechanisms</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authenticators">Authenticators</h3>
<div class="sect3">
<h4 id="mongo-realm-authenticator">Mongo Realm Authenticator</h4>
<div class="paragraph">
<p><strong>mongoRealAuthenticator</strong> authenticates users defined in a MongoDB collection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Mongo Realm Authenticator is suggested for production usage.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration allows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>defining the collection to use (<code>users-db</code> and <code>users-collection</code>), the properties of the user document to use as user id, password and roles (<code>prop-id</code>, <code>prop-password</code> and <code>json-path-roles</code>).</p>
</li>
<li>
<p>enabling hashed password using the strong bcrypt hashing algorithm (<code>bcrypt-hashed-password</code> and <code>bcrypt-complexity</code>); note that the password is automatically hashed on write requests and that the password property is automatically removed from responses.</p>
</li>
<li>
<p>allows initializing the users collection and the admin user if not existing. See <code>create-user</code> option.</p>
</li>
<li>
<p>allows controlling the users caching.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">mongoRealmAuthenticator</span><span class="pi">:</span>
    <span class="na">users-db</span><span class="pi">:</span> <span class="s">restheart</span>
    <span class="na">users-collection</span><span class="pi">:</span> <span class="s">users</span>
    <span class="na">prop-id</span><span class="pi">:</span> <span class="s">_id</span>
    <span class="na">prop-password</span><span class="pi">:</span> <span class="s">password</span>
    <span class="na">json-path-roles</span><span class="pi">:</span> <span class="s">$.roles</span>
    <span class="na">bcrypt-hashed-password</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">bcrypt-complexity</span><span class="pi">:</span> <span class="m">12</span>
    <span class="na">create-user</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">create-user-document</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{"_id":</span><span class="nv"> </span><span class="s">"admin",</span><span class="nv"> </span><span class="s">"password":</span><span class="nv"> </span><span class="s">"$2a$12$lZiMMNJ6pkyg4uq/I1cF5uxzUbU25aXHtg7W7sD2ED7DG1wzUoo6u",</span><span class="nv"> </span><span class="s">"roles":</span><span class="nv"> </span><span class="s">["admin"]}'</span>
    <span class="c1"># create-user-document.password must be hashed when bcrypt-hashed-password=true</span>
    <span class="c1"># default password is 'secret'</span>
    <span class="c1"># see https://bcrypt-generator.com but replace initial '$2y' with '$2a'</span>
    <span class="na">cache-enabled</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">cache-size</span><span class="pi">:</span> <span class="m">1000</span>
    <span class="na">cache-ttl</span><span class="pi">:</span> <span class="m">60000</span>
    <span class="na">cache-expire-policy</span><span class="pi">:</span> <span class="s">AFTER_WRITE</span>
    <span class="na">enforce-minimum-password-strenght</span><span class="pi">:</span> <span class="no">false</span>
    <span class="c1"># Integer from 0 to 4</span>
    <span class="c1"># 0 Weak        （guesses &lt; 3^10）</span>
    <span class="c1"># 1 Fair        （guesses &lt; 6^10）</span>
    <span class="c1"># 2 Good        （guesses &lt; 8^10）</span>
    <span class="c1"># 3 Strong      （guesses &lt; 10^10）</span>
    <span class="c1"># 4 Very strong （guesses &gt;= 10^10）</span>
    <span class="na">minimum-password-strength</span><span class="pi">:</span> <span class="s">3</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="file-realm-authenticator">File Realm Authenticator</h4>
<div class="paragraph">
<p><strong>fileRealmAuthenticator</strong> defines users credentials and roles in the configuration or in a simple yml configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">fileRealmAuthenticator</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="c1">#conf-file: ./etc/users.yml</span>
    <span class="na">users</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">userid</span><span class="pi">:</span> <span class="s">admin</span>
      <span class="na">password</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">roles</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">admin</span><span class="pi">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>conf-file</code> path is either absolute, or relative to the restheart configuration file (if specified) or relative to the plugins directory (if using the default configuration).</p>
</div>
<div class="paragraph">
<p>See <a href="https://github.com/SoftInstigate/restheart/blob/master/examples/example-conf-files/users.yml">users.yml</a> for an example users definition.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="token-managers">Token Managers</h3>
<div class="sect3">
<h4 id="random-token-manager">Random Token Manager</h4>
<div class="paragraph">
<p><strong>rndTokenService</strong> generates an auth token using a random number generator. It has two arguments, <code>ttl</code>, which is the tokens Time To Live in minutes, and <code>srv-uri</code> the URI of the service that allows to get and invalidate the user auth token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">rndTokenManager</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">ttl</span><span class="pi">:</span> <span class="m">15</span>
    <span class="na">srv-uri</span><span class="pi">:</span> <span class="s">/tokens</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jwt-token-manager">JWT Token Manager</h4>
<div class="paragraph">
<p><strong>jwtTokenManager</strong> An implementation of Token Manger that issues and verifies auth tokens in a cluster compatible way.</p>
</div>
<div class="paragraph">
<p>Each token can be verified by any node of the cluster regardless which one actually issued it (as long as they share the same secret)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="na">jwtTokenManager</span><span class="pi">:</span>
    <span class="na">key</span><span class="pi">:</span> <span class="s">secret</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">ttl</span><span class="pi">:</span> <span class="m">15</span>
    <span class="na">srv-uri</span><span class="pi">:</span> <span class="s">/tokens</span>
    <span class="na">issuer</span><span class="pi">:</span> <span class="s">restheart.com</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The query parameter renew-auth-token forces the token to be renewed.</p>
</div>
<div class="paragraph">
<p>Generating a new token is a cryptographic operation,
and it can have a significant performance overhead.
It is responsibility of the client to renew the token using this query parameter
when it is going to expiry somehow soon.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Watch <a href="https://www.youtube.com/watch?v=QVk0aboHayM&amp;t=1211s">Authenticators in RESTHeart</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoid-browsers-to-open-the-login-popup-window">Avoid browsers to open the login popup window</h3>
<div class="paragraph">
<p>The Basic and Digest Authentication protocols requires responding with a challenge when the request cannot be authenticated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="html">WWW-Authenticate: Basic realm="RESTHeart Realm"
WWW-Authenticate: Digest realm="RESTHeart Realm",domain="localhost",nonce="Toez71bBUPoNMTU0NDAwNDMzNjEwMXBY+Jp7YX/GVMcxAd61FpY=",opaque="00000000000000000000000000000000",algorithm=MD5,qop="auth"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In browsers this leads to the login popup windows. In our web applications we might want to redirect to a fancy login page when the 401 Unauthorized response code.</p>
</div>
<div class="paragraph">
<p>To avoid the popup window just add to the request the <code>noauthchallenge</code> query parameter or the header <code>No-Auth-Challenge</code>. This will skip the challenge response.</p>
</div>
</div>
        </div>
    </div>
</div>
    </div>

    <footer class="bs-docs-footer mt-0">
  <!-- <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script> -->
  <div id="fb-root"></div>
  <section id="mainFooter">
    <div class="container-fluid">
      <div>
        <div class="bs-docs-social">
          <ul class="socialNetwork">
            <li class="ml-auto">
              <a href="https://twitter.com/softinstigate" class="tips" title="Follow us on Twitter" data-original-title="follow us on Twitter"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#twitter" /></svg>
              </a>
            </li>
            <li>
              <a href="https://github.com/softinstigate/restheart" class="tips" title="Get the source code" data-original-title="get the source code"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#github" /></svg>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div>
        Made with
        <!--<span class="glyphicon glyphicon-heart"></span>-->
        <svg class="footer__like"><use xlink:href="/images/sprite.svg#like" /></svg>
        by
        <a href="https://www.softinstigate.com" target="_blank">SoftInstigate</a>
      </div>
      <div>
        <a href="https://softinstigate.com/en/privacy" class="mr-2 small">Privacy Policy</a>
        <a href="https://www.iubenda.com/privacy-policy/15571002/cookie-policy" class="small iubenda-nostyle no-brand iubenda-embed " title="Cookie Policy">Cookie Policy</a>
      </div>
    </section>
</footer>

    <!-- End Document ================================================== -->
</body>

</html>
<!-- add copy button on code snippet -->
<script src="/assets/js/clipboard.min.js"></script>
<style>
    .listingblock:hover .clipboard {
        display: block;
    }

    .clipboard {
        display: none;
        border: 0;
        font-size: .75em;
        text-transform: uppercase;
        font-weight: 800;
        padding: 2px;
        color: #999;
        position: absolute;
        top: 6px;
        right: 10px;
        background: transparent;
    }

    code + .clipboard {
        padding: 0;
    }

    .clipboard:hover, .clipboard:focus, .clipboard:active {
        outline: 0;
        color: white;
        /* background-color: #eee9e6; */
    }
</style>
<!-- add copy button on code snippet -->
<script>
    window.onload = function() {
        function target(b) {
            var p = b.parentNode;
            if (p.className.includes("highlight")) {
                var elems = p.getElementsByTagName("code");
                if (elems.length > 0) {
                    return elems[0];
                }
            }
            return p.childNodes[0];
        }

        var pre = document.getElementsByTagName('pre');
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copy';
            // b.innerHTML = '<i style="font-size:18px" class="icon-clipboard"></i>';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }

        var clipboard = new ClipboardJS('.clipboard', {
            // this custom text function, remove any line that doesn't start with $
            text: function (trigger) {
                var t = target(trigger);
                const text = target(trigger).outerText;

                if (text) {
                    const dataLang = t.getAttribute('data-lang');
                    if (dataLang === 'bash') {
                        return text
                            .replace(/^(?!\$.*$).*/gm, '') // remove lines that don't start with $
                            .replace(/^\$ */gm, '') // remove leading $
                            .replace(/^\s*[\r\n]/gm, '') // remove blank lines
                            .replace(/^\s+|\s+$/gm, ''); // trim string
                    }
                }
            },
            target: target
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copied';
            setTimeout(function() {
                e.trigger.textContent = 'Copy';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>