<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->

<html lang="en">
<!--<![endif]-->
<head>
   <meta charset="utf-8">
   <title>RESTHeart - Authentication and Authorization tutorial</title>
   <meta name="description" content="Low code API Framework for MongoDB">
   <meta name="author" content="SoftInstigate srl">
   <meta name="keywords" content="restheart,mongodb,rest,,graphql,api,http,microservice,java,framework">
   <!-- Open Graph -->
   <meta property="og:type" content="website">
   <meta property="og:url" content="https://restheart.org">
   <meta property="og:logo" content="/images/restheart logo.svg">
   <meta property="og:title" content="RESTHeart - Authentication and Authorization tutorial">
   <meta property="og:description" content="Low code API Framework for MongoDB">
   <meta property="og:locale" content="en">
   
   <!-- avoid search engine indexing of old documentation pages  -->
   <meta name="robots" content="noindex,nofollow">
   
   <!-- Mobile Specific Metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <!-- icon fonts -->
   <script src="/js/fontawesome.com_c39cf060d4.js"></script>
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons.css">
   <link type="text/css" rel="stylesheet" href="/font-icons/custom-icons/css/custom-icons-ie7.css">
   <!-- Custom css -->
   <link rel="stylesheet" type="text/css" href="/css/main.css">
   <!-- js ================================================== -->
   <script src="https://code.jquery.com/jquery.min.js"></script>
   <script src="/assets/js/bootstrap.bundle.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
   <script src="https://unpkg.com/@stackblitz/sdk/bundles/sdk.umd.js"></script>
   <script src="/js/carousel.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>
   <!-- Github buttons. -->
   <script async defer src="https://buttons.github.io/buttons.js"></script>
   <!--iframeResizer-->
  <script src="/assets/js/iframe-resizer.parent.js"></script>
   <!-- Favicons ================================================== -->
  <link rel="icon" type="image/svg+xml" href="/images/restheart logo.svg" />
  <link rel="shortcut icon" href="/images/favicon/favicon.png" />
  <link rel="canonical" href="https://restheart.org/docs/v7/security/tutorial">
  <link rel="alternate" type="application/atom+xml" title="RESTHeart - API Framework" href="https://restheart.org/feed.xml" />
  <script defer data-domain="restheart.org" src="https://plausible.io/js/script.js"></script>
</head>


<body>
    <header id="mainHeader" class="fixed-top background-primary" role="banner">
    <div class="container-fluid">
        <nav class="navbar navbar-default scrollMenu navbar-expand-lg" role="navigation">
            <a class="navbar-brand" href="/">
                <h2 class="text-white"><strong>REST</strong>Heart</h2>
            </a>
            <!-- Place this tag where you want the button to render. -->
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target=".navbar-ex1-collapse"><span
                    class="sr-only">Toggle navigation</span> &#x2630;</button>
            <div class="collapse navbar-collapse navbar-ex1-collapse background-primary" id="scrollTarget">
                <ul class="nav navbar-nav ml-md-auto">
                    <!-- only bounce slack button on home page-->
                    
                    

                    <li class="nav-item ml-1 ml-lg-2 ml-xl-4 mb-0 pb-0 ">
                        <a class="github-button" href="https://github.com/SoftInstigate/restheart" data-size="large" data-show-count="true" aria-label="Star SoftInstigate/restheart on GitHub"></a>
                    </li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/sophia">Ask Sophia</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs">Docs</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/faq">FAQ</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/docs/setup-with-docker/">GET</a></li>
                    <li class="nav-item"><a class="ml-1 ml-lg-2 ml-xl-4" href="/contact">Contacts</a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>

<div class="alert alert-warning m-0 text-center" role="alert">
    <strong>RESTHeart 8 is the current stable release. Switch documentation to <a href="/docs">v8</a></strong>
</div>



<a  target="_blank" class="gitter-open-chat-button fixed-bottom-right" href="https://join.slack.com/t/restheart/shared_invite/zt-1olrhtoq8-5DdYLBWYDonFGEALhmgSXQ"></a>


    <div class="page-content">
        <div class="container-fluid imgHover doc">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <div class="bd-sidebar__head">
                <div class="dropdown d-flex justify-content-center w-100">
                    <button class="btn btn-secondary dropdown-toggle w-100 p-1 mb-2" type="button"
                        id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        v7
                    </button>
                    <div class="dropdown-menu mt-2 mr-1 pb-2" aria-labelledby="dropdownMenuButton">
                      <a class="dropdown-item" href="/docs">
                            
                            v8
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v7">
                            
                            <strong>v7</strong>
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v6">
                            
                            v6
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v5">
                            
                            v5
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v4">
                            
                            v4
                            
                        </a>
                        <a class="dropdown-item" href="/docs/v3">
                            
                            v3
                            
                        </a>
                    </div>
                </div>
                <form action="https://www.google.com/search" class="form bd-sidebar__search d-flex" method="get"
                    name="searchform" target="_blank">
                    <input name="sitesearch" type="hidden" value="restheart.org/docs">
                    <input autocomplete="on" class="form-control input-sm search bd-sidebar__input" name="q"
                        placeholder="Search" required="required" type="text">
                    <button class="bd-sidebar__submit" type="submit">
                        <svg width="16" height="16">
                            <use xlink:href="/images/sprite.svg#search" /></svg>
                    </button>
                </form>
                <div class="d-flex flex-wrap justify-content-between align-items-center">
                    <a href="https://github.com/SoftInstigate/restheart-website/edit/master/docs/v7/security/tutorial.adoc"
                        class="small mt-2 mb-1 ml-lg-auto"><i class="icon-pencil"></i>Edit Page</a>
                    <button class="btn btn-link bd-sidebar__toggle p-0 mb-1 d-md-none" type="button"
                        data-toggle="collapse" data-target="#bd-sidebar__menu" aria-controls="bd-sidebar__menu"
                        aria-expanded="false" aria-label="Toggle docs navigation">
                        Table of Contents
                        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30"
                            focusable="false">
                            <title>Menu</title>
                            <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22" />
                        </svg>
                    </button>
                </div>
            </div>

            <nav class="bd-sidebar__menu collapse d-md-block" id="bd-sidebar__menu">
                
                    
<a data-toggle="collapse" href="#overview" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2>Overview</h2>
</a>
<ul id="overview" class="collapse">
    <li><a href="/docs/v7">Overview</a></li>
    <li><a href="/docs/v7/faq">FAQ</a></li>
    <li><a href="/docs/v7/plugins/tutorial">Framework Tutorial</a></li>
    <li><a href="/docs/v7/mongodb-rest/tutorial">REST API Tutorial</a></li>
    <li><a href="/docs/v7/mongodb-graphql/tutorial">GraphQL API Tutorial</a></li>
    <li><a href="/docs/v7/security/tutorial">Auth^2 Tutorial</a></li>
    <li><a href="/docs/v7/example-webapps">Example Web Apps built with RESTHeart</a></li>
    <li><a href="/docs/v7/performances">Performances</a></li>
    <li><a href="/docs/v7/blog-posts">Blog posts</a></li>
    <li><a href="/docs/v7/video-tutorials">Video Tutorials</a></li>
    <li><a href="/docs/v7/upgrade-to-v7"><strong>Upgrade to v7</strong></a></li>
    <li><a href="https://github.com/SoftInstigate/restheart/discussions/425">Roadmap</a></li>
</ul>

<a data-toggle="collapse" href="#setup" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Setup</h2>
</a>
<ul id="setup" class="collapse">
    <li><a href="/docs/v7/setup"><strong>Setup</strong></a></li>
    <li><a href="/docs/v7/setup-with-docker">Setup with Docker</a></li>
    <li><a href="/docs/v7/configuration">Configuration</a></li>
    <li><a href="/docs/v7/default-configuration">Default Configuration</a></li>
    <li><a href="/docs/v7/security/how-clients-authenticate">Client Authentication Howto</a></li>
    <li><a href="/docs/v7/security/user-management">User Management</a></li>
    <li><a href="/docs/v7/graalvm"><strong>GraalVM</strong></a></li>
    <li><a href="/docs/v7/security/security-hardening"><strong>Security Hardening</strong></a></li>
    <li><a href="/docs/v7/security/tls">Configure TLS</a></li>
    <li><a href="/docs/v7/security/secure-connection-to-mongodb">Secure connection to MongoDB</a></li>
    <li><a href="/docs/v7/proxy">Proxying requests</a></li>
    <li><a href="/docs/v7/static-resources">Serving static resources</a></li>
    <li><a href="/docs/v7/logging">Logging</a></li>
    <li><a href="/docs/v7/monitoring">Monitoring</a></li>
    <li><a href="/docs/v7/auditing">Auditing</a></li>
    <li><a href="/docs/v7/clustering">Clustering &amp; Load Balancing</a></li>
    <li><a href="/docs/v7/enterprise-license">Enterprise License</a></li>
</ul>

<a data-toggle="collapse" href="#framework" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Framework</h2>
</a>
<ul id="framework" class="collapse">
    <!-- <li><a href="/docs/v7/plugins/dev-env">Development Environment</a></li> -->
    <li><a href="/docs/v7/plugins/overview">Overview</a></li>
    <li><a href="/docs/v7/plugins/tutorial">Tutorial</a></li>
    <li><a href="/docs/v7/plugins/deploy">How to deploy Plugins</a></li>
    <h3 id="rest-api" class="mt-2">Base Plugins</h2>
    <li><a href="/docs/v7/plugins/services">Services</a></li>
    <li><a href="/docs/v7/plugins/interceptors">Interceptors</a></li>
    <li><a href="/docs/v7/plugins/providers">Providers</a></li>
    <li><a href="/docs/v7/plugins/initializers">Initializers</a></li>
    <li><a href="/docs/v7/plugins/core-plugins-js">Services and Inteceptors in JavaScript</a></li>
    <h3 id="rest-api" class="mt-2">Security Plugins</h2>
    <li><a href="/docs/v7/security/overview">Overview</a></li>
    <li><a href="/docs/v7/plugins/authentication-mechanisms">Authentication Mechanisms</a></li>
    <li><a href="/docs/v7/plugins/authenticators">Authenticators</a></li>
    <li><a href="/docs/v7/plugins/authorizers">Authorizers</a></li>
    <li><a href="/docs/v7/plugins/token-managers">Token Managers</a></li>
</ul>

<a data-toggle="collapse" href="#security" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">Security Plugins</h2>
</a>
<ul id="security" class="collapse">
    <li><a href="/docs/v7/security/tutorial">Auth^2 Tutorial</a></li>
    <li><a href="/docs/v7/security/authentication">Authentication</a></li>
    <li><a href="/docs/v7/security/authorization">Authorization</a></li>
    <li><a href="/docs/v7/security/other-security-plugins">Other Security Plugins</a></li>
</ul>

<a  data-toggle="collapse" href="#mongodb" role="button" aria-expanded="false" aria-controls="collapseExample">
    <h2 class="mt-2">MongoDB Plugins</h2>
</a>
<ul id="mongodb" class="collapse">
    <h3 id="rest-api" class="mt-2">REST API</h2>
    <li><a href="/docs/v7/mongodb-rest/tutorial">Tutorial</a></li>
    <li><a href="/docs/v7/mongodb-rest/read-docs">Read Documents</a></li>
    <li><a href="/docs/v7/mongodb-rest/write-docs">Write Documents</a></li>
    <li><a href="/docs/v7/mongodb-rest/files">Binary Files with GridFS</a></li>
    <li><a href="/docs/v7/mongodb-rest/aggregations">Aggregations</a></li>
    <li><a href="/docs/v7/mongodb-rest/caching">Caching</a></li>
    <li><a href="/docs/v7/mongodb-rest/dbs-collections">Manage Dbs and Collections</a></li>
    <li><a href="/docs/v7/mongodb-rest/indexes">Indexes</a></li>
    <li><a href="/docs/v7/mongodb-rest/relationships">Relationships</a></li>
    <li><a href="/docs/v7/mongodb-rest/csv">Upload CSV files</a></li>
    <li><a href="/docs/v7/mongodb-rest/json-schema-validation">JSON Schema Validation</a></li>
    <li><a href="/docs/v7/mongodb-rest/transactions">Transactions</a></li>
    <li><a href="/docs/v7/mongodb-rest/resource-uri">Resource URIs</a></li>
    <li><a href="/docs/v7/mongodb-rest/representation-format">Representation Format</a></li>
    <li><a href="/docs/v7/mongodb-rest/sample-data">Load Sample Data into MongoDB</a></li>
    <li><a href="/docs/v7/mongodb-rest/etag">ETag</a></li>
    <li><a href="/docs/v7/mongodb-rest/shard-keys">Shard Keys</a></li>
    <li><a href="/docs/v7/mongodb-rest/monitoring">Monitoring</a></li>


    <h3 id="rest-api" class="mt-2">GraphQL API</h3>
    <li><a href="/docs/v7/mongodb-graphql/">Overview</a></li>
    <li><a href="/docs/v7/mongodb-graphql/tutorial">Tutorial</a></li>
    <li><a href="/docs/v7/mongodb-graphql/graphql-apps">GraphQL App Definition</a></li>
    <li><a href="/docs/v7/mongodb-graphql/optimization">Optimization</a></li>
    <li><a href="/docs/v7/mongodb-graphql/complex-app-example">A complex GraphQL App</a></li>

    <h3 id="rest-api" class="mt-2">Websocket API</h3>
    <li><a href="/docs/v7/mongodb-websocket/">Overview</a></li>
    <li><a href="/docs/v7/mongodb-websocket/change-streams">Streams definition</a></li>
    <li><a href="/docs/v7/mongodb-websocket/variables">Variables</a></li>
    <li><a href="/docs/v7/mongodb-websocket/examples">Examples</a></li>
</ul>

<style>
.collapsing {
    -webkit-transition: none;
    transition: none;
    display: none;
}
</style>

<script type="text/javascript">
    // on page load, show the menu element of the current pages
    const menu = 'security';
    if (menu) {
        $(`#${menu}`).collapse('show');
    }
</script>
                
            </nav>
        </div>

        <div class="d-none d-xl-block col-xl-2 order-last bd-toc">
            <ul class="sectlevel2">
<li><a href="#what-you-need">What you need</a></li>
<li><a href="#starting-restheart-and-mongodb">Starting RESTHeart and MongoDB</a></li>
<li><a href="#the-admin-user">The Admin User</a></li>
<li><a href="#creating-collection-secrets">Creating Collection /secrets</a></li>
<li><a href="#creating-users-alice-and-bob">Creating Users alice and bob</a></li>
<li><a href="#understanding-status-codes">Understanding Status Codes</a></li>
<li><a href="#configuring-access-for-user-role-on-secrets">Configuring Access for user Role on /secrets</a></li>
<li><a href="#creating-secret-documents">Creating Secret Documents</a></li>
<li><a href="#reading-secret-documents">Reading Secret Documents</a></li>
</ul>
        </div>
        <div class="col-12 col-md-9 col-xl-8 py-md-3 bd-content">
            <div class="docs-head d-flex align-items-center justify-content-between">
    <h2 class="d-flex align-items-center m-0 pr-3">
        <span>Authentication and Authorization tutorial</span>
    </h2>
</div>
            <div class="paragraph">
<p>This tutorial aims to provide a thorough understanding of securing RESTHeart applications. RESTHeart offers robust security features, with <strong>Authentication</strong> and <strong>Authorization</strong> being central to these. This guide will explore the basic authentication. We&#8217;ll also delve into authorization, focusing on Access Control Lists (ACLs) and their role in defining permissions.</p>
</div>
<div class="paragraph">
<p>By the end of this tutorial, you&#8217;ll have a solid foundation in securing RESTHeart applications, ensuring data security and controlled access.</p>
</div>
<div class="sect2">
<h3 id="what-you-need">What you need</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Docker</strong>: For running RESTHeart.</p>
</li>
<li>
<p><strong>HTTPie</strong>: A user-friendly command-line HTTP client. Download at <a href="https://httpie.io/cli" target="_blank" rel="noopener">httpie.io/cli</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="starting-restheart-and-mongodb">Starting RESTHeart and MongoDB</h3>
<div class="paragraph">
<p>To begin, create a directory for RESTHeart and use Docker Compose to start both RESTHeart and MongoDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir </span>restheart <span class="o">&amp;&amp;</span> <span class="nb">cd </span>restheart
<span class="nv">$ </span>curl https://raw.githubusercontent.com/SoftInstigate/restheart/master/docker-compose.yml <span class="nt">--output</span> docker-compose.yml
<span class="nv">$ </span>docker compose up <span class="nt">--attach</span> restheart</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-admin-user">The Admin User</h3>
<div class="paragraph">
<p>Upon first launch, <code>mongoRealmAuthenticator</code> creates an <code>admin</code> user with default password <code>secret</code> and the <code>admin</code> role. This role is configured as the root role in <code>mongoAclAuthorizer</code>, granting full permissions.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<strong>Always change the <code>admin</code> user&#8217;s password</strong> to maintain security.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To change the <code>admin</code> password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret PATCH :8080/users/admin <span class="nv">password</span><span class="o">=</span><span class="s2">"my-strong-password"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-collection-secrets">Creating Collection /secrets</h3>
<div class="paragraph">
<p>Using <code>admin</code>, create the <code>/secrets</code> collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret PUT :8080/secrets</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-users-alice-and-bob">Creating Users alice and bob</h3>
<div class="paragraph">
<p>Next, create two users, <code>alice</code> and <code>bob</code>, each with the <code>user</code> role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret POST :8080/users <span class="nv">_id</span><span class="o">=</span>alice <span class="nv">password</span><span class="o">=</span>secret roles:<span class="o">=</span><span class="s1">'["user"]'</span>
<span class="nv">$ </span>http <span class="nt">-a</span> admin:secret POST :8080/users <span class="nv">_id</span><span class="o">=</span>bob <span class="nv">password</span><span class="o">=</span>secret roles:<span class="o">=</span><span class="s1">'["user"]'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="understanding-status-codes">Understanding Status Codes</h3>
<div class="paragraph">
<p>The <code>/users/{id}</code> endpoint can verify credentials. For example, using incorrect credentials for <code>alice</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> alice:wrong GET :8080/secrets
HTTP/1.1 401 Unauthorized</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
A <code>401 Unauthorized</code> response indicates failed authentication due to incorrect credentials. RESTHeart blocks requests to secure services without proper authentication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Attempting access with correct credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> alice:secret GET :8080/secrets
HTTP/1.1 403 Forbidden</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
A <code>403 Forbidden</code> response means authentication succeeded, but the client lacks permission to access the resource.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RESTHeart&#8217;s default authorizer, <code>mongoAclAuthorizer</code>, enforces permissions based on user roles and ACL configurations.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-access-for-user-role-on-secrets">Configuring Access for user Role on /secrets</h3>
<div class="paragraph">
<p>We aim to allow <code>user</code> role to create and access their own documents in <code>/secrets</code>, and to modify only their documents.</p>
</div>
<div class="paragraph">
<p>1) <strong>Allow <code>GET</code> on <code>/secrets</code></strong>:</p>
</div>
<div class="paragraph">
<p>Users can only access documents they created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">{</span>
    <span class="s2">"_id"</span>: <span class="s2">"userCanAccessOwnSecret"</span>,
    <span class="s2">"roles"</span>: <span class="o">[</span> <span class="s2">"user"</span> <span class="o">]</span>,
    <span class="s2">"predicate"</span>: <span class="s2">"method(GET) and path('/secrets')"</span>,
    <span class="s2">"priority"</span>: 100,
    <span class="s2">"mongo"</span>: <span class="o">{</span> <span class="s2">"readFilter"</span>: <span class="s2">"{ author: @user._id }"</span> <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>2) <strong>Allow <code>POST</code> on <code>/secrets</code></strong>:</p>
</div>
<div class="paragraph">
<p>Users can create new documents, setting the <code>author</code> to their <code>_id</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">{</span>
    <span class="s2">"_id"</span>: <span class="s2">"userCanCreateOwnSecret"</span>,
    <span class="s2">"roles"</span>: <span class="o">[</span> <span class="s2">"user"</span> <span class="o">]</span>,
    <span class="s2">"predicate"</span>: <span class="s2">"method(POST) and path('/secrets')"</span>,
    <span class="s2">"priority"</span>: 100,
    <span class="s2">"mongo"</span>: <span class="o">{</span> <span class="s2">"mergeRequest"</span>: <span class="o">{</span> <span class="s2">"author"</span>: <span class="s2">"@user._id"</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>3) <strong>Allow <code>PATCH</code> on <code>/secrets/{id}</code></strong>:</p>
</div>
<div class="paragraph">
<p>Users can modify only their documents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">{</span>
    <span class="s2">"_id"</span>: <span class="s2">"userCanModifyOwnSecret"</span>,
    <span class="s2">"roles"</span>: <span class="o">[</span> <span class="s2">"user"</span> <span class="o">]</span>,
    <span class="s2">"predicate"</span>: <span class="s2">"method(PATCH) and path-template('/secrets/{id}')"</span>,
    <span class="s2">"priority"</span>: 100,
    <span class="s2">"mongo"</span>: <span class="o">{</span> <span class="s2">"writeFilter"</span>: <span class="o">{</span> <span class="s2">"author"</span>: <span class="s2">"@user._id"</span> <span class="o">}</span> <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To create these permissions, use the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret POST :8080/acl <span class="nv">_id</span><span class="o">=</span>userCanAccessOwnSecret roles:<span class="o">=</span><span class="s1">'["user"]'</span> priority:<span class="o">=</span>100 <span class="nv">predicate</span><span class="o">=</span><span class="s2">"method(GET) and path('/secrets')"</span> mongo.readFilter:<span class="o">=</span><span class="s1">'{ "author": "@user._id" }'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret POST :8080/acl <span class="nv">_id</span><span class="o">=</span>userCanCreateOwnSecret roles:<span class="o">=</span><span class="s1">'["user"]'</span> priority:<span class="o">=</span>100 <span class="nv">predicate</span><span class="o">=</span><span class="s2">"method(POST) and path('/secrets')"</span> mongo.mergeRequest:<span class="o">=</span><span class="s1">'{ "author": "@user._id" }'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret POST :8080/acl <span class="nv">_id</span><span class="o">=</span>userCanModifyOwnSecret roles:<span class="o">=</span><span class="s1">'["user"]'</span> priority:<span class="o">=</span>100 <span class="nv">predicate</span><span class="o">=</span><span class="s2">"method(PATCH) and path-template('/secrets/{id}')"</span> mongo.writeFilter:<span class="o">=</span><span class="s1">'{ "author": "@user._id" }'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-secret-documents">Creating Secret Documents</h3>
<div class="paragraph">
<p>Let&#8217;s have <code>alice</code> and <code>bob</code> create their secrets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> bob:secret POST :8080/secrets <span class="nv">message</span><span class="o">=</span><span class="s2">"Bob loves Alice"</span>
<span class="nv">$ </span>http <span class="nt">-a</span> alice:secret POST :8080/secrets <span class="nv">message</span><span class="o">=</span><span class="s2">"Alice loves Bob"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reading-secret-documents">Reading Secret Documents</h3>
<div class="paragraph">
<p>Viewing with <code>admin</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> admin:secret <span class="nt">-b</span> GET :8080/secrets
<span class="c"># Output includes both Alice's and Bob's messages</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>author</code> property is correctly set for each document.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Accessing <code>/secrets</code> as <code>alice</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> alice:secret <span class="nt">-b</span> GET :8080/secrets
<span class="c"># Output includes only Alice's message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, accessing as <code>bob</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$ </span>http <span class="nt">-a</span> bob:secret <span class="nt">-b</span> GET :8080/secrets
<span class="c"># Output includes only Bob's message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a moment to acknowledge the story of Alice and Bob. These two characters are entwined in an 'impossible love' story that symbolizes the challenges of secure communication in the digital age. And RESTHeart is no exception keeping their love hidden in the /secrets collection.</p>
</div>
</div>
        </div>
    </div>
</div>
    </div>

    <footer class="bs-docs-footer mt-0">
  <!-- <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script> -->
  <div id="fb-root"></div>
  <section id="mainFooter">
    <div class="container-fluid">
      <div>
        <div class="bs-docs-social">
          <ul class="socialNetwork">
            <li class="ml-auto">
              <a href="https://twitter.com/softinstigate" class="tips" title="Follow us on Twitter" data-original-title="follow us on Twitter"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#twitter" /></svg>
              </a>
            </li>
            <li>
              <a href="https://github.com/softinstigate/restheart" class="tips" title="Get the source code" data-original-title="get the source code"
                target="_blank">
                <svg class="socialNetwork__icon"><use xlink:href="/images/sprite.svg#github" /></svg>
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div>
        Made with
        <!--<span class="glyphicon glyphicon-heart"></span>-->
        <svg class="footer__like"><use xlink:href="/images/sprite.svg#like" /></svg>
        by
        <a href="https://www.softinstigate.com" target="_blank">SoftInstigate</a>
      </div>
      <div>
        <a href="https://softinstigate.com/en/privacy" class="mr-2 small">Privacy Policy</a>
        <a href="https://www.iubenda.com/privacy-policy/15571002/cookie-policy" class="small iubenda-nostyle no-brand iubenda-embed " title="Cookie Policy">Cookie Policy</a>
      </div>
    </section>
</footer>

    <!-- End Document ================================================== -->
</body>

</html>
<!-- add copy button on code snippet -->
<script src="/assets/js/clipboard.min.js"></script>
<style>
    .listingblock:hover .clipboard {
        display: block;
    }

    .clipboard {
        display: none;
        border: 0;
        font-size: .75em;
        text-transform: uppercase;
        font-weight: 800;
        padding: 2px;
        color: #999;
        position: absolute;
        top: 6px;
        right: 10px;
        background: transparent;
    }

    code + .clipboard {
        padding: 0;
    }

    .clipboard:hover, .clipboard:focus, .clipboard:active {
        outline: 0;
        color: white;
        /* background-color: #eee9e6; */
    }
</style>
<!-- add copy button on code snippet -->
<script>
    window.onload = function() {
        function target(b) {
            var p = b.parentNode;
            if (p.className.includes("highlight")) {
                var elems = p.getElementsByTagName("code");
                if (elems.length > 0) {
                    return elems[0];
                }
            }
            return p.childNodes[0];
        }

        var pre = document.getElementsByTagName('pre');
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copy';
            // b.innerHTML = '<i style="font-size:18px" class="icon-clipboard"></i>';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }

        var clipboard = new ClipboardJS('.clipboard', {
            // this custom text function, remove any line that doesn't start with $
            text: function (trigger) {
                var t = target(trigger);
                const text = target(trigger).outerText;

                if (text) {
                    const dataLang = t.getAttribute('data-lang');
                    if (dataLang === 'bash') {
                        return text
                            .replace(/^(?!\$.*$).*/gm, '') // remove lines that don't start with $
                            .replace(/^\$ */gm, '') // remove leading $
                            .replace(/^\s*[\r\n]/gm, '') // remove blank lines
                            .replace(/^\s+|\s+$/gm, ''); // trim string
                    }
                }
            },
            target: target
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copied';
            setTimeout(function() {
                e.trigger.textContent = 'Copy';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>