This is a very simple Angular 12 Web Application hosted at StackBlitz.

{: .bs-callout.bs-callout-info}
Check also `restheart-webchat` official [repository](https://github.com/SoftInstigate/restheart-webchat)! 


It uses Restheart [Websockets and ChangeStreams](https://restheart.org/docs/change-streams/) under the hoods which provide an instant, 
zero lines of code API for a realtime chat application.

### Define your stream

The only setup required is to create a stream definition on `messages`. 

The stream `all` will notify our app for every document `insert` operation on the collection:

{% highlight bash %}

$ curl -i -H "Content-Type:application/json" -X PATCH https://demo.restheart.org/messages/ -d '{
    "streams": [
        {
            "stages": [
                {
                    "_$match": {
                        "_$or": [
                            {
                                "operationType": "insert"
                            }
                        ]
                    }
                }
            ],
            "uri": "all"
        }
    ]
}'

HTTP/1.1 200 OK
...


{% endhighlight %}


{: .bs-callout.bs-callout-info}
Click on `Editor` button and open the code of `message.service.ts`. You'll see how is easy interacting with the RESTHeart API!

<div id="rh-webchat-demo"></div>

<script type="text/javascript">
StackBlitzSDK.embedGithubProject('rh-webchat-demo', 'SoftInstigate/restheart-webchat/tree/master/client', {
  openFile: 'src/app/services/message.service.ts',
  view: 'preview',
  width: "100%",
  height: "660px",
  hideNavigation: true,
  forceEmbedLayout: true
});
</script>


## Try the API online

You can use the online demo service so you can play with API without the need to install MongoDB and RESTHeart.

The online demo API exposes *messages* collection at `https://demo.restheart.org/messages` without requiring authentication.

<div class="row mt-5">
    <div class="col-lg-3 pt-2">
        <p><strong>Get</strong> full <i>messages</i> collection<br />
        <code>GET /db/coll/</code></p>
    </div>
    <div class="col-lg-9">
{% highlight bash %}

$ curl GET https://demo.restheart.org/messages/

[
    {
        "_id": {
            "$oid": "60e6faa1df782f5287cc51a2"
        },
        "body": "ðŸ‘€",
        "timestamp": "2021-07-08T13:16:17.255Z",
        "nickname": "Maurizio",
        "_etag": {
            "$oid": "60e6faa1df782f5287cc51a1"
        }
    },
    {
        "_id": {
            "$oid": "60e6f854df782f5287cc51a0"
        },
        "body": "ðŸ˜‚",
        "timestamp": "2021-07-08T13:06:28.484Z",
        "nickname": "mkj6",
        "_etag": {
            "$oid": "60e6f854df782f5287cc519f"
        }
    },
    {
        "_id": {
            "$oid": "60e6f82bdf782f5287cc519e"
        },
        "body": "who's this mkj6? Sounds to me quite mad!",
        "timestamp": "2021-07-08T13:05:47.526Z",
        "nickname": "Andrea",
        "_etag": {
            "$oid": "60e6f82bdf782f5287cc519d"
        }
    }, 
    ...
]

{% endhighlight %}
        <a href="http://restninja.io/share/607325d540eaa2eac909116d619be26ad21a9055/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>


<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Create</strong> a simple Websocket connection to <code>all</code> stream on <code>messages</code> collection and log every received message to the console.</p>
    </div>
    <div class="col-lg-9">

{% highlight javascript %}
// Using javascript

const w = new WebSocket("wss://demo.restheart.org/messages/_streams/all")

w.onmessage = (e)=>console.log(JSON.parse(e.data))

{% endhighlight %}
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Create</strong> a message document with <code>POST /db/coll</code></p>
        <p>If the _id is not specified in the request body, it will be autogenerated as a new ObjectId. The <code>Location</code> response header specifies the URL of the new document.</p>
    </div>
    <div class="col-lg-9">
    
{% highlight bash %}

$ curl -i -H "Content-Type:application/json" -X POST https://demo.restheart.org/messages/ -d '
    {
        "body": "RESTHeart Rocks!!",
        "timestamp": "2021-07-12T14:48:05.603Z",
        "nickname": "you",
    }'

HTTP/1.1 201 Created
Location: https://demo.restheart.org/messages/60ec5e31fc1979075d81fa14
...

{% endhighlight %}
    <a href="http://restninja.io/share/1fd808b1f51037c8b2b36d43d6bc315a0325029c/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Check websocket log</strong></p>
        Your websocket should have logged something like this.
    </div>
    <div class="col-lg-9">
{% highlight javascript %}

{
    "fullDocument": {
        "_id": {
            "$oid": "60ec61bffc1979075d81fa1b"
        },
        "body": "RESTHeart Rocks!!",
        "timestamp": "2021-07-12T15:37:35.876Z",
        "nickname": "you",
        "_etag": {
            "$oid": "60ec61bffc1979075d81fa1a"
        }
    },
    "documentKey": {
        "_id": {
            "$oid": "60ec61bffc1979075d81fa1b"
        }
    },
    "operationType": "insert"
}

{% endhighlight %}
    <a href="https://restninja.io/share/7da53c179386d7df995c1e5574984d700cc0aef7/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>


<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Get</strong> the created document</p>
    </div>
    <div class="col-lg-9">
{% highlight bash %}

$ curl -i https://demo.restheart.org/messages/60ec5e31fc1979075d81fa14

{
    "_id": {
        "$oid": "60ec5e31fc1979075d81fa14"
    },
    "body": "RESTHeart Rocks!!",
    "timestamp": "2021-07-12T14:48:05.603Z",
    "nickname": "you",
    "_etag": {
        "$oid": "60ec5e31fc1979075d81fa13"
    }
}

{% endhighlight %}
    <a href="https://restninja.io/share/7da53c179386d7df995c1e5574984d700cc0aef7/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>


<!-- <div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Update</strong> the first document with <code>PATCH /db/coll/docid</code></p>
        <p>This request uses the dot notation and the <code>$currentDate</code> operator. These are available in all write requests!</p>
    </div>
    <div class="col-lg-9">
{% highlight bash %}

$ curl -i -H "key:demo" -H "Content-Type:application/json" -X PATCH https://demo.restheart.org/messages/docid -d '{"$currentDate": { "header.timestamp": true}}'

HTTP/1.1 200 OK
...

{% endhighlight %}
    <a href="http://restninja.io/share/69ddd0c6d311ae99d6596f46d092556f324635d2/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Get</strong> the updated document again.</p>
        <p>The returned representation contains all the document properties plus few more. The <code>_etag</code> is updated automatically by RESTHeart for Web caching and ghost writes management.</p>
    </div>
    <div class="col-lg-9">
{% highlight bash %}

$ curl -i -H "key:demo" https://demo.restheart.org/messages/docid

{
	"_id": "docid",
	"from": "you",
	"message": "RESTHeart rocks!!",
	"header": {
		"timestamp": {
			"$date": 1475598488601
		}
	}
}

{% endhighlight %}
    <a href="https://restninja.io/share/7da53c179386d7df995c1e5574984d700cc0aef7/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Find</strong> documents via query.</p>
        <p>The <code>filter</code> query parameter allows to specify any MongoDB query.</p>
        <p>This instance of RESTHeart is configured to always add the <code>np</code> query parameter to the request; it gets rid of the collection properties and 
        returns just an array of documents.</p>
    </div>
    <div class="col-lg-9">
{% highlight bash %}

$ curl -H "key:demo" -G --data-urlencode "filter={'from':'you'}" https://beta.mrest.io/demo/messages?pagesize=2

[   {
		"_id": "docid",
		"from": "you",
		"message": "RESTHeart rocks!",
		"header": {
			"timestamp": {
				"$date": 1475598488601
			}
		}
	}, {
		"_id": {
			"$oid": "563a40d6e4b0ef984cae182b"
		},
		"from": "you",
		"message": "MongoDB rocks as well!"
	}
]

{% endhighlight %}
    <a href="http://restninja.io/share/694a0a5c4ae939230544d6dee093d72d27ae2dae/3" class="btn btn-sm float-right mb-2" target="_blank">Open on rest ninja</a>
    </div>
</div>
 -->