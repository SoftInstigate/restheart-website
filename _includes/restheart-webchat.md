This is a very simple Angular 12 Web Application hosted at StackBlitz. 

{: .bs-callout.bs-callout-info}
Source code is available at `restheart-webchat`  official Github [repository](https://github.com/SoftInstigate/restheart-webchat)! 


This example application uses RESTHeart [Websockets and ChangeStreams](https://restheart.org/docs/change-streams/) under the hood which provide an instant, 
zero lines of code API for a realtime chat application.

### Define your stream

The only setup required is to create a stream definition on `messages`. 

The stream `all` that will notify our app for every document `insert` operation on the collection has been defined as follows:

{% highlight bash %}

$ curl -i -H "Content-Type:application/json" -X PATCH https://demo.restheart.org/messages/ -d '{
    "streams": [
        {
            "stages": [
                {
                    "_$match": {
                        "_$or": [
                            {
                                "operationType": "insert"
                            }
                        ]
                    }
                }
            ],
            "uri": "all"
        }
    ]
}'

HTTP/1.1 200 OK
...
{% endhighlight %}

<iframe src="https://chat.restheart.org" width="100%" height="600px" title="restheat-ng-demo"></iframe>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Create</strong> a simple Websocket connection to <code>all</code> stream on <code>messages</code> collection and log every received message to the console.</p>
    </div>
    <div class="col-lg-9">

{% highlight javascript %}
// Using javascript in Google Chrome's console

const w = new WebSocket("wss://demo.restheart.org/messages/_streams/all")

w.onmessage = (e)=>console.log(JSON.parse(e.data))

{% endhighlight %}
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Create</strong> a message document with <code>POST /db/coll</code></p>
        <p>If the _id is not specified in the request body, it will be autogenerated as a new ObjectId. The <code>Location</code> response header specifies the URL of the new document.</p>
    </div>
    <div class="col-lg-9">
    
{% highlight bash %}

$ curl -i -H "Content-Type:application/json" -X POST https://demo.restheart.org/messages/ -d '
    {
        "message": "RESTHeart Rocks!!",
        "from": "you"
    }'

HTTP/1.1 201 Created
Location: https://demo.restheart.org/messages/60eda28bfc1979075d81fad6
...

{% endhighlight %}
    <a href="https://restninja.io/share/9fa04fa80e839e4928b2c92c462810848ee1addf/0" class="btn btn-sm float-right" target="_blank">Open on rest ninja</a>
    </div>
</div>

<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Check websocket log</strong></p>
        Your websocket should have logged a <a href="https://docs.mongodb.com/manual/reference/change-events/"  target="_blank">Change Event</a> that will look like something like this.
    </div>
    <div class="col-lg-9">
{% highlight javascript %}

{
    "fullDocument": {
        "_id": {
            "$oid": "60eda28bfc1979075d81fad6"
        },
        "message": "RESTHeart Rocks!!",
        "from": "you",
        "timestamp": {
            "$date": 1626186379000
        },
        "_etag": {
            "$oid": "60eda28bfc1979075d81fad5"
        }
    },
    "documentKey": {
        "_id": {
            "$oid": "60eda28bfc1979075d81fad6"
        }
    },
    "operationType": "insert"
}

{% endhighlight %}
    </div>
</div>


<div class="row mt-3">
    <div class="col-lg-3 pt-2">
        <p><strong>Get</strong> the created document using the previously returned <code>Location</code> header reference.</p>
    </div>
    <div class="col-lg-9">
{% highlight bash %}

$ curl -i https://demo.restheart.org/messages/60eda28bfc1979075d81fad6

{
    "_id": {
        "$oid": "60eda28bfc1979075d81fad6"
    },
    "from": "you",
    "message": "RESTHeart Rocks!!",
    "timestamp": {
        "$date": 1626185719000
    },
    "_etag": {
        "$oid": "60eda28bfc1979075d81fad5"
    }
}

{% endhighlight %}
    </div>
</div>